<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Module: Adhearsion::VoIP::Asterisk::Commands
  
    &mdash; Documentation by YARD 0.7.2
  
</title>

  <link rel="stylesheet" href="../../../css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="../../../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '../../..';
  if (relpath != '') relpath += '/';
</script>

  <script type="text/javascript" charset="utf-8" src="../../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../../js/app.js"></script>


  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="../../../_index.html">Index (C)</a> &raquo; 
    <span class='title'><span class='object_link'><a href="../../../Adhearsion.html" title="Adhearsion (module)">Adhearsion</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../../VoIP.html" title="Adhearsion::VoIP (module)">VoIP</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Asterisk.html" title="Adhearsion::VoIP::Asterisk (module)">Asterisk</a></span></span>
     &raquo; 
    <span class="title">Commands</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a id="class_list_link" href="#">Class List</a>
  
    <a id="method_list_link" href="#">Method List</a>
  
    <a id="file_list_link" href="#">File List</a>
  
</div>
      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Module: Adhearsion::VoIP::Asterisk::Commands
  
  
  
</h1>

<dl class="box">
  
  
    
  
    
  
  
  
    <dt class="r1 last">Defined in:</dt>
    <dd class="r1 last">lib/adhearsion/voip/asterisk/commands.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Defined Under Namespace</h2>
<p class="children">
   
    
      <strong class="modules">Modules:</strong> <span class='object_link'><a href="Commands/MenuDigitResponse.html" title="Adhearsion::VoIP::Asterisk::Commands::MenuDigitResponse (module)">MenuDigitResponse</a></span>, <span class='object_link'><a href="Commands/SpeechEngines.html" title="Adhearsion::VoIP::Asterisk::Commands::SpeechEngines (module)">SpeechEngines</a></span>
    
   
    
      <strong class="classes">Classes:</strong> <span class='object_link'><a href="Commands/QueueProxy.html" title="Adhearsion::VoIP::Asterisk::Commands::QueueProxy (class)">QueueProxy</a></span>
    
  
</p>

  <h2>Constant Summary</h2>
  
    <dl class="constants">
      
        <dt id="RESPONSE_PREFIX-constant" class="">RESPONSE_PREFIX =
          
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>200 result=</span><span class='tstring_end'>&quot;</span></span></pre></dd>
      
        <dt id="AGI_SUCCESSFUL_RESPONSE-constant" class="">AGI_SUCCESSFUL_RESPONSE =
          
        </dt>
        <dd><pre class="code"><span class='const'>RESPONSE_PREFIX</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1</span><span class='tstring_end'>&quot;</span></span></pre></dd>
      
        <dt id="DIAL_STATUSES-constant" class="">DIAL_STATUSES =
          
        </dt>
        <dd><pre class="code"><span class='const'>Hash</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='symbol'>:unknown</span><span class='rparen'>)</span><span class='period'>.</span><span class='id merge'>merge</span><span class='lparen'>(</span><span class='symbol'>:answer</span>      <span class='op'>=&gt;</span> <span class='symbol'>:answered</span><span class='comma'>,</span> <span class='comment'>#:doc:
</span><span class='symbol'>:congestion</span>  <span class='op'>=&gt;</span> <span class='symbol'>:congested</span><span class='comma'>,</span>
<span class='symbol'>:busy</span>        <span class='op'>=&gt;</span> <span class='symbol'>:busy</span><span class='comma'>,</span>
<span class='symbol'>:cancel</span>      <span class='op'>=&gt;</span> <span class='symbol'>:cancelled</span><span class='comma'>,</span>
<span class='symbol'>:noanswer</span>    <span class='op'>=&gt;</span> <span class='symbol'>:unanswered</span><span class='comma'>,</span>
<span class='symbol'>:cancelled</span>   <span class='op'>=&gt;</span> <span class='symbol'>:cancelled</span><span class='comma'>,</span>
<span class='symbol'>:chanunavail</span> <span class='op'>=&gt;</span> <span class='symbol'>:channel_unavailable</span><span class='rparen'>)</span></pre></dd>
      
        <dt id="DYNAMIC_FEATURE_EXTENSIONS-constant" class="">DYNAMIC_FEATURE_EXTENSIONS =
          
        </dt>
        <dd><pre class="code"><span class='lbrace'>{</span>
  <span class='symbol'>:attended_transfer</span> <span class='op'>=&gt;</span> <span class='id lambda'>lambda</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id options'>options</span><span class='op'>|</span>
    <span class='id variable'>variable</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>TRANSFER_CONTEXT</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id options'>options</span><span class='lbracket'>[</span><span class='symbol'>:context</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id options'>options</span> <span class='op'>&amp;&amp;</span> <span class='id options'>options</span><span class='period'>.</span><span class='id has_key?'>has_key?</span><span class='lparen'>(</span><span class='symbol'>:context</span><span class='rparen'>)</span>
    <span class='id extend_dynamic_features_with'>extend_dynamic_features_with</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>atxfer</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span><span class='comma'>,</span>
  <span class='symbol'>:blind_transfer</span> <span class='op'>=&gt;</span> <span class='id lambda'>lambda</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id options'>options</span><span class='op'>|</span>
    <span class='id variable'>variable</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>TRANSFER_CONTEXT</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id options'>options</span><span class='lbracket'>[</span><span class='symbol'>:context</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id options'>options</span> <span class='op'>&amp;&amp;</span> <span class='id options'>options</span><span class='period'>.</span><span class='id has_key?'>has_key?</span><span class='lparen'>(</span><span class='symbol'>:context</span><span class='rparen'>)</span>
    <span class='id extend_dynamic_features_with'>extend_dynamic_features_with</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>blindxfer</span><span class='tstring_end'>'</span></span>
  <span class='kw'>end</span>
<span class='rbrace'>}</span></pre></dd>
      
        <dt id="PLAYBACK_SUCCESS-constant" class="">PLAYBACK_SUCCESS =
          
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>SUCCESS</span><span class='tstring_end'>'</span></span></pre></dd>
      
    </dl>
  





  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#answer-instance_method" title="#answer (instance method)">- (Object) <strong>answer</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
This must be called first before any other commands can be issued.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#base_record_to_file-instance_method" title="#base_record_to_file (instance method)">- (Object) <strong>base_record_to_file</strong>(*args) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
this is a base methor record_to_file and record_to_file! and should only be
used via those methods.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#check_voicemail-instance_method" title="#check_voicemail (instance method)">- (Object) <strong>check_voicemail</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#dial-instance_method" title="#dial (instance method)">- (Object) <strong>dial</strong>(number, options = {}) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Dial an extension or &#8220;phone number&#8221; in asterisk.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#disable_feature-instance_method" title="#disable_feature (instance method)">- (Object) <strong>disable_feature</strong>(feature_name) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Disables a feature name specified in features.conf.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#dtmf-instance_method" title="#dtmf (instance method)">- (Object) <strong>dtmf</strong>(digits) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Simulates pressing the specified digits over the current channel.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#duration_of-instance_method" title="#duration_of (instance method)">- (Float) <strong>duration_of</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Get the number of seconds the given block takes to execute.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#enable_feature-instance_method" title="#enable_feature (instance method)">- (Object) <strong>enable_feature</strong>(feature_name, optional_options = nil) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
A high-level way of enabling features you create/uncomment from
features.conf.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#execute-instance_method" title="#execute (instance method)">- (Object) <strong>execute</strong>(application, *arguments) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
This asterisk dialplan command allows you to instruct Asterisk to start
applications which are typically run from extensions.conf.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_variable-instance_method" title="#get_variable (instance method)">- (Object) <strong>get_variable</strong>(variable_name) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Issue this command to access a channel variable that exists in the asterisk
dialplan (i.e. extensions.conf) Use get_variable to pass information from
other modules or high level configurations from the asterisk dialplan to
the adhearsion dialplan.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#hangup-instance_method" title="#hangup (instance method)">- (Object) <strong>hangup</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Hangs up the current channel.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#inline_result_with_return_value-instance_method" title="#inline_result_with_return_value (instance method)">- (Object) <strong>inline_result_with_return_value</strong>(result) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Parses a response in the form of &#8220;200 result=0 (some_value)&#8221;.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#inline_return_value-instance_method" title="#inline_return_value (instance method)">- (Object) <strong>inline_return_value</strong>(result) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Parses a response in the form of &#8220;200 result=some_value&#8221;.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#input-instance_method" title="#input (instance method)">- (String) <strong>input</strong>(*args, &amp;block) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Used to receive keypad input from the user.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#input%21-instance_method" title="#input! (instance method)">- (String) <strong>input!</strong>(*args, &amp;block) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Same as <span class='object_link'><a href="#input-instance_method" title="Adhearsion::VoIP::Asterisk::Commands#input (method)">#input</a></span>, but immediately raises an exception if sound playback
fails.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#interruptible_play-instance_method" title="#interruptible_play (instance method)">- (String<sup>?</sup>) <strong>interruptible_play</strong>(*files) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Play a sequence of files, stopping the playback if a digit is pressed.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#interruptible_play%21-instance_method" title="#interruptible_play! (instance method)">- (String<sup>?</sup>) <strong>interruptible_play!</strong>(*files) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Same as <span class='object_link'><a href="#interruptible_play-instance_method" title="Adhearsion::VoIP::Asterisk::Commands#interruptible_play (method)">#interruptible_play</a></span>, but immediately raises an exception if a
sound file cannot be played.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#join-instance_method" title="#join (instance method)">- (Object) <strong>join</strong>(conference_id, options = {}) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Used to join a particular conference with the MeetMe application.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#jump_to-instance_method" title="#jump_to (instance method)">- (Object) <strong>jump_to</strong>(context, overrides = {}) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Jumps to a context.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#last_dial_status-instance_method" title="#last_dial_status (instance method)">- (Object) <strong>last_dial_status</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Get the status of the last dial().
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#last_dial_successful%3F-instance_method" title="#last_dial_successful? (instance method)">- (Boolean) <strong>last_dial_successful?</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
as reported by Asterisk.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#last_dial_unsuccessful%3F-instance_method" title="#last_dial_unsuccessful? (instance method)">- (Boolean) <strong>last_dial_unsuccessful?</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Opposite of last_dial_successful?().
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#menu-instance_method" title="#menu (instance method)">- (Object) <strong>menu</strong>(*args, &amp;block) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Creates an interactive menu for the caller.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#messages_waiting%3F-instance_method" title="#messages_waiting? (instance method)">- (Boolean) <strong>messages_waiting?</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
This command should be used to check if a message is waiting on the
Asterisk Comedian Voicemail application.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#next_message-instance_method" title="#next_message (instance method)">- (Object) <strong>next_message</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
This command should be used to advance to the next message in the Asterisk
Comedian Voicemail application.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#play-instance_method" title="#play (instance method)">- (Boolean) <strong>play</strong>(*arguments) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Plays the specified sound file names.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#play%21-instance_method" title="#play! (instance method)">- (true) <strong>play!</strong>(*arguments) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Same as <span class='object_link'><a href="#play-instance_method" title="Adhearsion::VoIP::Asterisk::Commands#play (method)">#play</a></span>, but immediately raises an exception if a sound file cannot
be played.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#play_or_speak-instance_method" title="#play_or_speak (instance method)">- (true) <strong>play_or_speak</strong>(prompts) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Attempts to play a sound prompt.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#play_time-instance_method" title="#play_time (instance method)">- (Object) <strong>play_time</strong>(*args) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Plays the given Date, Time, or Integer (seconds since epoch) using the
given timezone and format.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#queue-instance_method" title="#queue (instance method)">- (Adhearsion::VoIP::Asterisk::Commands::QueueProxy) <strong>queue</strong>(queue_name) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Place a call in a queue to be answered by a registered agent.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#quote_arg-instance_method" title="#quote_arg (instance method)">- (Object) <strong>quote_arg</strong>(arg) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Arguments surrounded by quotes; quotes backslash-escaped.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#raw_response-instance_method" title="#raw_response (instance method)">- (Object) <strong>raw_response</strong>(message = nil) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
The underlying method executed by nearly all the command methods in this
module.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#read-instance_method" title="#read (instance method)">- (Object) <strong>read</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Utility method to read from pbx.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#record-instance_method" title="#record (instance method)">- (String) <strong>record</strong>(*args) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Records a sound file with the given name.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#record_to_file-instance_method" title="#record_to_file (instance method)">- (Symbol) <strong>record_to_file</strong>(*args) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Records a sound file with the given name.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#record_to_file%21-instance_method" title="#record_to_file! (instance method)">- (Object) <strong>record_to_file!</strong>(*args) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
This works the same record_to_file except is throws an exception if a
playback or write error occurs.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#response-instance_method" title="#response (instance method)">- (Object) <strong>response</strong>(command, *arguments) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#say_chars-instance_method" title="#say_chars (instance method)">- (Object) <strong>say_chars</strong>(text) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Executes the SayAlpha command.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#say_digits-instance_method" title="#say_digits (instance method)">- (Object) <strong>say_digits</strong>(digits) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Speaks the digits given as an argument.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#say_phonetic-instance_method" title="#say_phonetic (instance method)">- (Object) <strong>say_phonetic</strong>(text) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Executes the SayPhonetic command.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#set_variable-instance_method" title="#set_variable (instance method)">- (Object) <strong>set_variable</strong>(variable_name, value) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Pass information back to the asterisk dial plan.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#sip_add_header-instance_method" title="#sip_add_header (instance method)">- (String) <strong>sip_add_header</strong>(header, value) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Issue the command to add a custom SIP header to the current call channel
example use: sip_add_header(&#8220;x-ahn-test&#8221;,
&#8220;rubyrox&#8221;).
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#sip_get_header-instance_method" title="#sip_get_header (instance method)">- (String) <strong>sip_get_header</strong>(header) </a>
    

    
      (also: #sip_header)
    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Issue the command to fetch a SIP header from the current call channel
example use: sip_get_header(&#8220;x-ahn-test&#8221;).
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#speak-instance_method" title="#speak (instance method)">- (Object) <strong>speak</strong>(text, options = {}) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#variable-instance_method" title="#variable (instance method)">- (Object) <strong>variable</strong>(*args) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Allows you to either set or get a channel variable from Asterisk.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#verbose-instance_method" title="#verbose (instance method)">- (Object) <strong>verbose</strong>(message, level = nil) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Sends a message to the console via the verbose message system.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#voicemail-instance_method" title="#voicemail (instance method)">- (Object) <strong>voicemail</strong>(*args) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Send a caller to a voicemail box to leave a message.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#voicemail_main-instance_method" title="#voicemail_main (instance method)">- (Object) <strong>voicemail_main</strong>(options = {}) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
The voicemail_main method puts a caller into the voicemail system to fetch
their voicemail or set options for their voicemail box.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#with_next_message-instance_method" title="#with_next_message (instance method)">- (Object) <strong>with_next_message</strong>(&amp;block) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
The with_next_message method&#8230;
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#write-instance_method" title="#write (instance method)">- (Object) <strong>write</strong>(message) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Utility method to write to pbx.
</p>
</div></span>
  
</li>

      
    </ul>
  



  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="answer-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>answer</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
This must be called first before any other commands can be issued. In
typical Adhearsion applications this is called by default as soon as a call
is transfered to a valid context in dialplan.rb. If you do not want your
Adhearsion application to automatically issue an answer command, then you
must edit your startup.rb file and configure this setting. Keep in mind
that you should not need to issue another answer command after one has
already been issued either explicitly by your code or implicitly by the
standard adhearsion configuration.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


153
154
155
156</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/adhearsion/voip/asterisk/commands.rb', line 153</span>

<span class='kw'>def</span> <span class='id answer'>answer</span>
  <span class='id response'>response</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ANSWER</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>true</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="base_record_to_file-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>base_record_to_file</strong>(*args) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
this is a base methor record_to_file and record_to_file! and should only be
used via those methods
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/adhearsion/voip/asterisk/commands.rb', line 412</span>

<span class='kw'>def</span> <span class='id base_record_to_file'>base_record_to_file</span><span class='lparen'>(</span><span class='op'>*</span><span class='id args'>args</span><span class='rparen'>)</span>
  <span class='id options'>options</span> <span class='op'>=</span> <span class='id args'>args</span><span class='period'>.</span><span class='id last'>last</span><span class='period'>.</span><span class='id kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Hash</span><span class='rparen'>)</span> <span class='op'>?</span> <span class='id args'>args</span><span class='period'>.</span><span class='id pop'>pop</span> <span class='op'>:</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='id filename'>filename</span> <span class='op'>=</span> <span class='id args'>args</span><span class='period'>.</span><span class='id shift'>shift</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/tmp/recording_%d</span><span class='tstring_end'>&quot;</span></span>

  <span class='kw'>if</span> <span class='id filename'>filename</span><span class='period'>.</span><span class='id index'>index</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%d</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='ivar'>@call</span><span class='period'>.</span><span class='id variables'>variables</span><span class='period'>.</span><span class='id has_key?'>has_key?</span><span class='lparen'>(</span><span class='symbol'>:recording_counter</span><span class='rparen'>)</span>
      <span class='ivar'>@call</span><span class='period'>.</span><span class='id variables'>variables</span><span class='lbracket'>[</span><span class='symbol'>:recording_counter</span><span class='rbracket'>]</span> <span class='op'>+=</span> <span class='int'>1</span>
    <span class='kw'>else</span>
      <span class='ivar'>@call</span><span class='period'>.</span><span class='id variables'>variables</span><span class='lbracket'>[</span><span class='symbol'>:recording_counter</span><span class='rbracket'>]</span>  <span class='op'>=</span> <span class='int'>0</span>
    <span class='kw'>end</span>
    <span class='id filename'>filename</span> <span class='op'>=</span> <span class='id filename'>filename</span> <span class='op'>%</span> <span class='ivar'>@call</span><span class='period'>.</span><span class='id variables'>variables</span><span class='lbracket'>[</span><span class='symbol'>:recording_counter</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='lparen'>(</span><span class='op'>!</span><span class='id options'>options</span><span class='period'>.</span><span class='id has_key?'>has_key?</span><span class='lparen'>(</span><span class='symbol'>:format</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='id format'>format</span> <span class='op'>=</span> <span class='id filename'>filename</span><span class='period'>.</span><span class='id slice!'>slice!</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\.[^\.]+$</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='lparen'>(</span><span class='id format'>format</span><span class='period'>.</span><span class='id nil?'>nil?</span><span class='rparen'>)</span>
      <span class='id ahn_log'>ahn_log</span><span class='period'>.</span><span class='id agi'>agi</span><span class='period'>.</span><span class='id warn'>warn</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Format not specified and not detected.  Defaulting to \&quot;gsm\&quot;</span><span class='tstring_end'>&quot;</span></span>
      <span class='id format'>format</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>gsm</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
    <span class='id format'>format</span><span class='period'>.</span><span class='id sub!'>sub!</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^\.</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='id format'>format</span> <span class='op'>=</span> <span class='id options'>options</span><span class='period'>.</span><span class='id delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:format</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># maxduration must be in milliseconds when using RECORD FILE
</span>  <span class='id maxduration'>maxduration</span> <span class='op'>=</span> <span class='id options'>options</span><span class='period'>.</span><span class='id delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:maxduration</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='op'>-</span><span class='int'>1</span>
  <span class='id maxduration'>maxduration</span> <span class='op'>=</span> <span class='id maxduration'>maxduration</span> <span class='op'>*</span> <span class='int'>1000</span> <span class='kw'>if</span> <span class='id maxduration'>maxduration</span> <span class='op'>&gt;</span> <span class='int'>0</span>

  <span class='id escapedigits'>escapedigits</span> <span class='op'>=</span> <span class='id options'>options</span><span class='period'>.</span><span class='id delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:escapedigits</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>#</span><span class='tstring_end'>&quot;</span></span>
  <span class='id silence'>silence</span>     <span class='op'>=</span> <span class='id options'>options</span><span class='period'>.</span><span class='id delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:silence</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='int'>0</span>

  <span class='id response_params'>response_params</span> <span class='op'>=</span> <span class='id filename'>filename</span><span class='comma'>,</span> <span class='id format'>format</span><span class='comma'>,</span> <span class='id escapedigits'>escapedigits</span><span class='comma'>,</span> <span class='id maxduration'>maxduration</span><span class='comma'>,</span> <span class='int'>0</span>          
  <span class='id response_values'>response_values</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
 
  <span class='kw'>if</span> <span class='op'>!</span><span class='id options'>options</span><span class='period'>.</span><span class='id has_key?'>has_key?</span> <span class='symbol'>:beep</span> 
    <span class='id response_params'>response_params</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>BEEP</span><span class='tstring_end'>'</span></span>
  <span class='kw'>elsif</span> <span class='id options'>options</span><span class='lbracket'>[</span><span class='symbol'>:beep</span><span class='rbracket'>]</span>
    <span class='id play_soundfile'>play_soundfile</span> <span class='id options'>options</span><span class='lbracket'>[</span><span class='symbol'>:beep</span><span class='rbracket'>]</span>
    <span class='id playback_response'>playback_response</span> <span class='op'>=</span> <span class='id get_variable'>get_variable</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>PLAYBACKSTATUS</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id playback_response'>playback_response</span> <span class='op'>!=</span> <span class='const'>PLAYBACK_SUCCESS</span> 
      <span class='id response_values'>response_values</span> <span class='op'>&lt;&lt;</span> <span class='symbol'>:playback_error</span>
      <span class='id response_values'>response_values</span> <span class='op'>&lt;&lt;</span> <span class='id playback_response'>playback_response</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id silence'>silence</span> <span class='op'>&gt;</span> <span class='int'>0</span>
    <span class='id response_params'>response_params</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>s=</span><span class='embexpr_beg'>#{</span><span class='id silence'>silence</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='id resp'>resp</span> <span class='op'>=</span> <span class='id response'>response</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>RECORD FILE</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='id response_params'>response_params</span>
  <span class='comment'># If the user hangs up before the recording is entered, -1 is returned by asterisk and RECORDED_FILE
</span>  <span class='comment'># will not contain the name of the file, even though it IS in fact recorded.
</span>  <span class='kw'>if</span> <span class='id resp'>resp</span><span class='period'>.</span><span class='id match'>match</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>hangup</span><span class='regexp_end'>/</span></span>
    <span class='id response_values'>response_values</span> <span class='op'>&lt;&lt;</span> <span class='symbol'>:hangup</span>
  <span class='kw'>elsif</span> <span class='id resp'>resp</span><span class='period'>.</span><span class='id match'>match</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>writefile</span><span class='regexp_end'>/</span></span>
    <span class='id response_values'>response_values</span> <span class='op'>&lt;&lt;</span> <span class='symbol'>:write_error</span> 
  <span class='kw'>elsif</span> <span class='id resp'>resp</span><span class='period'>.</span><span class='id match'>match</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>dtmf</span><span class='regexp_end'>/</span></span>
    <span class='id response_values'>response_values</span> <span class='op'>&lt;&lt;</span> <span class='symbol'>:success_dtmf</span>
  <span class='kw'>elsif</span> <span class='id resp'>resp</span><span class='period'>.</span><span class='id match'>match</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>timeout</span><span class='regexp_end'>/</span></span>
    <span class='id response_values'>response_values</span> <span class='op'>&lt;&lt;</span> <span class='symbol'>:success_timeout</span>
  <span class='kw'>end</span>

  <span class='id response_values'>response_values</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="check_voicemail-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>check_voicemail</strong> 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1144
1145
1146
1147</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/adhearsion/voip/asterisk/commands.rb', line 1144</span>

<span class='kw'>def</span> <span class='id check_voicemail'>check_voicemail</span>
  <span class='id ahn_log'>ahn_log</span><span class='period'>.</span><span class='id agi'>agi</span><span class='period'>.</span><span class='id warn'>warn</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>THE check_voicemail() DIALPLAN METHOD WILL SOON BE DEPRECATED! CHANGE THIS TO voicemail_main() INSTEAD</span><span class='tstring_end'>&quot;</span></span>
  <span class='id voicemail_main'>voicemail_main</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="dial-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>dial</strong>(number, options = {}) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Dial an extension or &#8220;phone number&#8221; in asterisk. Maps to the
Asterisk DIAL command in the asterisk dialplan.
</p>
<p>
Be careful to not just specify a number like 5001, 9095551001 You must
specify a properly formatted string as Asterisk would expect to use in
order to understand whether the call should be dialed using SIP, IAX, or
some other means.
</p>
<p>
<tt>:caller_id</tt> - the caller id number to be used when the call is
placed.  It is advised you properly adhere to the policy of VoIP
termination providers with respect to caller id values.
</p>
<p>
<tt>:name</tt> - this is the name which should be passed with the caller ID
information if :name=>&#8220;John Doe&#8221; and :caller_id =>
&#8220;444-333-1000&#8221; then the compelete CID and name would be
&#8220;John Doe&#8221; <4443331000> support for caller id information
varies from country to country and from one VoIP termination provider to
another.
</p>
<p>
<tt>:for</tt> - this option can be thought of best as a timeout.  i.e.
timeout after :for if no one answers the call For example,
dial(&#8220;SIP/jay-desk-650&amp;SIP/jay-desk-601&amp;SIP/jay-desk-601-2&#8221;,
:for => 15.seconds, :caller_id => callerid) this call will timeout after 15
seconds if 1 of the 3 extensions being dialed do not pick prior to the 15
second time limit
</p>
<p>
<tt>:options</tt> - This is a string of options like &#8220;Tr&#8221; which
are supported by the asterisk DIAL application. for a complete list of
these options and their usage please check the link below.
</p>
<p>
<tt>:confirm</tt> - ?
</p>
<p>
for this call specified by the variable my_callerid
</p>
<pre class="code">
  <span class='id dial'>dial</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SIP/jay-desk-650&amp;SIP/jay-desk-601&amp;SIP/jay-desk-601-2</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:for</span> <span class='op'>=&gt;</span> <span class='int'>15</span><span class='period'>.</span><span class='id seconds'>seconds</span><span class='comma'>,</span> <span class='symbol'>:caller_id</span> <span class='op'>=&gt;</span> <span class='id my_callerid'>my_callerid</span></pre>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h3>Examples:</h3>
    
      <h4><div class='inline'><p>
Make a call to the PSTN using my SIP provider for VoIP termination
</p>
</div></h4>
      <pre class="example code"><span class='id dial'>dial</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SIP/19095551001@my.sip.voip.terminator.us</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span></pre>
    
      <h4><div class='inline'><p>
Make 3 Simulataneous calls to the SIP extensions separated by &amp;
symbols, try for 15 seconds and use the callerid
</p>
</div></h4>
      <pre class="example code"></pre>
    
      <h4><div class='inline'><p>
Make a call using the IAX provider to the PSTN
</p>
</div></h4>
      <pre class="example code"><span class='id dial'>dial</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>IAX2/my.id@voipjet/19095551234</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:name</span><span class='op'>=&gt;</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>John Doe</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:caller_id</span><span class='op'>=&gt;</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>9095551234</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span></pre>
    
  </div>
<h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>number</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
represents the extension or &#8220;number&#8221; that asterisk should dial.
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
    </li>
  
</ul>
<h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
    </li>
  
</ul>

  <h3>See Also:</h3>
  <ul class="see">
    
      <li><a href="http://www.voip-info.org/wiki-Asterisk+cmd+Dial" target="_parent" title="Asterisk Dial Command">Asterisk Dial Command</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1186
1187
1188
1189
1190
1191
1192
1193
1194
1195
1196
1197</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/adhearsion/voip/asterisk/commands.rb', line 1186</span>

<span class='kw'>def</span> <span class='id dial'>dial</span><span class='lparen'>(</span><span class='id number'>number</span><span class='comma'>,</span> <span class='id options'>options</span><span class='op'>=</span><span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='op'>*</span><span class='id recognized_options'>recognized_options</span> <span class='op'>=</span> <span class='symbol'>:caller_id</span><span class='comma'>,</span> <span class='symbol'>:name</span><span class='comma'>,</span> <span class='symbol'>:for</span><span class='comma'>,</span> <span class='symbol'>:options</span><span class='comma'>,</span> <span class='symbol'>:confirm</span>

  <span class='id unrecognized_options'>unrecognized_options</span> <span class='op'>=</span> <span class='id options'>options</span><span class='period'>.</span><span class='id keys'>keys</span> <span class='op'>-</span> <span class='id recognized_options'>recognized_options</span>
  <span class='id raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unknown dial options: </span><span class='embexpr_beg'>#{</span><span class='id unrecognized_options'>unrecognized_options</span><span class='period'>.</span><span class='id to_sentence'>to_sentence</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id unrecognized_options'>unrecognized_options</span><span class='period'>.</span><span class='id any?'>any?</span>
  <span class='id set_caller_id_name'>set_caller_id_name</span> <span class='id options'>options</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span>
  <span class='id set_caller_id_number'>set_caller_id_number</span> <span class='id options'>options</span><span class='lbracket'>[</span><span class='symbol'>:caller_id</span><span class='rbracket'>]</span>
  <span class='id confirm_option'>confirm_option</span> <span class='op'>=</span> <span class='id dial_macro_option_compiler'>dial_macro_option_compiler</span> <span class='id options'>options</span><span class='lbracket'>[</span><span class='symbol'>:confirm</span><span class='rbracket'>]</span>
  <span class='id all_options'>all_options</span> <span class='op'>=</span> <span class='id options'>options</span><span class='lbracket'>[</span><span class='symbol'>:options</span><span class='rbracket'>]</span>
  <span class='id all_options'>all_options</span> <span class='op'>=</span> <span class='id all_options'>all_options</span> <span class='op'>?</span> <span class='id all_options'>all_options</span> <span class='op'>+</span> <span class='id confirm_option'>confirm_option</span> <span class='op'>:</span> <span class='id confirm_option'>confirm_option</span>
  <span class='id execute'>execute</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Dial</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id number'>number</span><span class='comma'>,</span> <span class='id options'>options</span><span class='lbracket'>[</span><span class='symbol'>:for</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id all_options'>all_options</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="disable_feature-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>disable_feature</strong>(feature_name) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Disables a feature name specified in features.conf. If you&#8217;re
disabling it, it was probably set by enable_feature().
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>feature_name</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


966
967
968
969
970
971
972
973</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/adhearsion/voip/asterisk/commands.rb', line 966</span>

<span class='kw'>def</span> <span class='id disable_feature'>disable_feature</span><span class='lparen'>(</span><span class='id feature_name'>feature_name</span><span class='rparen'>)</span>
  <span class='id enabled_features_variable'>enabled_features_variable</span> <span class='op'>=</span> <span class='id variable'>variable</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>DYNAMIC_FEATURES</span><span class='tstring_end'>'</span></span>
  <span class='id enabled_features'>enabled_features</span> <span class='op'>=</span> <span class='id enabled_features_variable'>enabled_features_variable</span><span class='period'>.</span><span class='id split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>#</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id enabled_features'>enabled_features</span><span class='period'>.</span><span class='id include?'>include?</span> <span class='id feature_name'>feature_name</span>
    <span class='id enabled_features'>enabled_features</span><span class='period'>.</span><span class='id delete'>delete</span> <span class='id feature_name'>feature_name</span>
    <span class='id variable'>variable</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>DYNAMIC_FEATURES</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='id enabled_features'>enabled_features</span><span class='period'>.</span><span class='id join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>#</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="dtmf-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>dtmf</strong>(digits) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Simulates pressing the specified digits over the current channel. Can be
used to traverse a phone menu.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


479
480
481</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/adhearsion/voip/asterisk/commands.rb', line 479</span>

<span class='kw'>def</span> <span class='id dtmf'>dtmf</span><span class='lparen'>(</span><span class='id digits'>digits</span><span class='rparen'>)</span>
  <span class='id execute'>execute</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SendDTMF</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id digits'>digits</span><span class='period'>.</span><span class='id to_s'>to_s</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="duration_of-instance_method">
  
    - (<tt>Float</tt>) <strong>duration_of</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Get the number of seconds the given block takes to execute. This is
particularly useful in dialplans for tracking billable time. Note that if
the call is hung up during the block, you will need to rescue the exception
if you have some mission-critical logic after it with which you&#8217;re
recording this return-value.
</p>


  </div>
</div>
<div class="tags">
  <h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Float</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
number of seconds taken for block to execute
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1234
1235
1236
1237
1238</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/adhearsion/voip/asterisk/commands.rb', line 1234</span>

<span class='kw'>def</span> <span class='id duration_of'>duration_of</span>
  <span class='id start_time'>start_time</span> <span class='op'>=</span> <span class='const'>Time</span><span class='period'>.</span><span class='id now'>now</span>
  <span class='kw'>yield</span>
  <span class='const'>Time</span><span class='period'>.</span><span class='id now'>now</span> <span class='op'>-</span> <span class='id start_time'>start_time</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="enable_feature-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>enable_feature</strong>(feature_name, optional_options = nil) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
A high-level way of enabling features you create/uncomment from
features.conf.
</p>
<p>
Certain Symbol features you enable (as defined in
DYNAMIC_FEATURE_EXTENSIONS) have optional arguments that you can also
specify here. The usage examples show how to do this.
</p>
<p>
Usage examples:
</p>
<pre class="code">
  <span class='id enable_feature'>enable_feature</span> <span class='symbol'>:attended_transfer</span>                        <span class='comment'># Enables &quot;atxfer&quot;
</span>
  <span class='id enable_feature'>enable_feature</span> <span class='symbol'>:attended_transfer</span><span class='comma'>,</span> <span class='symbol'>:context</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>my_dial</span><span class='tstring_end'>&quot;</span></span> <span class='comment'># Enables &quot;atxfer&quot; and then
</span>                                                           <span class='comment'># sets &quot;TRANSFER_CONTEXT&quot; to :context's value
</span>
  <span class='id enable_feature'>enable_feature</span> <span class='symbol'>:blind_transfer</span><span class='comma'>,</span> <span class='symbol'>:context</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>my_dial</span><span class='tstring_end'>'</span></span>    <span class='comment'># Enables 'blindxfer' and sets TRANSFER_CONTEXT
</span>
  <span class='id enable_feature'>enable_feature</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foobar</span><span class='tstring_end'>&quot;</span></span>                                  <span class='comment'># Enables &quot;foobar&quot;
</span>
  <span class='id enable_feature'>enable_feature</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>dup</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='semicolon'>;</span> <span class='id enable_feature'>enable_feature</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>dup</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>             <span class='comment'># Enables &quot;dup&quot; only once.</span></pre>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


952
953
954
955
956
957
958
959
960</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/adhearsion/voip/asterisk/commands.rb', line 952</span>

<span class='kw'>def</span> <span class='id enable_feature'>enable_feature</span><span class='lparen'>(</span><span class='id feature_name'>feature_name</span><span class='comma'>,</span> <span class='id optional_options'>optional_options</span><span class='op'>=</span><span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='const'>DYNAMIC_FEATURE_EXTENSIONS</span><span class='period'>.</span><span class='id has_key?'>has_key?</span> <span class='id feature_name'>feature_name</span>
    <span class='id instance_exec'>instance_exec</span><span class='lparen'>(</span><span class='id optional_options'>optional_options</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='const'>DYNAMIC_FEATURE_EXTENSIONS</span><span class='lbracket'>[</span><span class='id feature_name'>feature_name</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='id raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>You cannot supply optional options when the feature name is </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span>
                         <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>not internally recognized!</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id optional_options'>optional_options</span>
    <span class='id extend_dynamic_features_with'>extend_dynamic_features_with</span> <span class='id feature_name'>feature_name</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="execute-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>execute</strong>(application, *arguments) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
This asterisk dialplan command allows you to instruct Asterisk to start
applications which are typically run from extensions.conf.
</p>
<p>
The most common commands are already made available through the FAGI
interface provided by this code base. For commands that do not fall into
this category, then exec is what you should use.
</p>
<p>
For example, if there are specific asterisk modules you have loaded that
will not be available through the standard commands provided through FAGI -
then you can used EXEC.
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h3>Examples:</h3>
    
      <h4><div class='inline'><p>
Using execute in this way will add a header to an existing SIP call.
</p>
</div></h4>
      <pre class="example code"><span class='id execute'>execute</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>SIPAddHeader</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_end'>&quot;Call-Info: answer-after=0&quot;</span></span></pre>
    
  </div>

  <h3>See Also:</h3>
  <ul class="see">
    
      <li><a href="http://www.voip-info.org/wiki/view/Asterisk+-+documentation+of+application+commands" target="_parent" title="Asterisk Dialplan Commands">Asterisk Dialplan Commands</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


172
173
174
175
176
177
178</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/adhearsion/voip/asterisk/commands.rb', line 172</span>

<span class='kw'>def</span> <span class='id execute'>execute</span><span class='lparen'>(</span><span class='id application'>application</span><span class='comma'>,</span> <span class='op'>*</span><span class='id arguments'>arguments</span><span class='rparen'>)</span>
  <span class='id command'>command</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>EXEC </span><span class='embexpr_beg'>#{</span><span class='id application'>application</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='id arguments'>arguments</span> <span class='op'>=</span> <span class='id arguments'>arguments</span><span class='period'>.</span><span class='id map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id arg'>arg</span><span class='op'>|</span> <span class='id quote_arg'>quote_arg</span><span class='lparen'>(</span><span class='id arg'>arg</span><span class='rparen'>)</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id join'>join</span><span class='lparen'>(</span><span class='const'>AHN_CONFIG</span><span class='period'>.</span><span class='id asterisk'>asterisk</span><span class='period'>.</span><span class='id argument_delimiter'>argument_delimiter</span><span class='rparen'>)</span>
  <span class='id result'>result</span> <span class='op'>=</span> <span class='id raw_response'>raw_response</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id command'>command</span><span class='rbrace'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id arguments'>arguments</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='id error?'>error?</span><span class='lparen'>(</span><span class='id result'>result</span><span class='rparen'>)</span>
  <span class='id result'>result</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="get_variable-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>get_variable</strong>(variable_name) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Issue this command to access a channel variable that exists in the asterisk
dialplan (i.e. extensions.conf) Use get_variable to pass information from
other modules or high level configurations from the asterisk dialplan to
the adhearsion dialplan.
</p>
<p>
@see: <a
href="http://www.voip-info.org/wiki/view/get+variable">www.voip-info.org/wiki/view/get+variable</a>
Asterisk Get Variable
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>variable_name</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1005
1006
1007</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/adhearsion/voip/asterisk/commands.rb', line 1005</span>

<span class='kw'>def</span> <span class='id get_variable'>get_variable</span><span class='lparen'>(</span><span class='id variable_name'>variable_name</span><span class='rparen'>)</span>
  <span class='id inline_result_with_return_value'>inline_result_with_return_value</span> <span class='id response'>response</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>GET VARIABLE</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id variable_name'>variable_name</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="hangup-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>hangup</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Hangs up the current channel. After this command is issued, you will not be
able to send any more AGI commands but the dialplan Thread will still
continue, allowing you to do any post-call work.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


201
202
203</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/adhearsion/voip/asterisk/commands.rb', line 201</span>

<span class='kw'>def</span> <span class='id hangup'>hangup</span>
  <span class='id response'>response</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>HANGUP</span><span class='tstring_end'>'</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="inline_result_with_return_value-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>inline_result_with_return_value</strong>(result) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Parses a response in the form of &#8220;200 result=0 (some_value)&#8220;
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


136
137
138
139
140
141
142
143</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/adhearsion/voip/asterisk/commands.rb', line 136</span>

<span class='kw'>def</span> <span class='id inline_result_with_return_value'>inline_result_with_return_value</span><span class='lparen'>(</span><span class='id result'>result</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>unless</span> <span class='id result'>result</span>
  <span class='kw'>case</span> <span class='id result'>result</span><span class='period'>.</span><span class='id chomp'>chomp</span>
  <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>200 result=0</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>then</span> <span class='kw'>nil</span>
  <span class='kw'>when</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^</span><span class='embexpr_beg'>#{</span><span class='const'>AGI_SUCCESSFUL_RESPONSE</span><span class='rbrace'>}</span><span class='tstring_content'> \((.*)\)$</span><span class='regexp_end'>/</span></span> <span class='kw'>then</span> <span class='gvar'>$LAST_PAREN_MATCH</span>
  <span class='kw'>else</span> <span class='id raise'>raise</span> <span class='const'>AGIProtocolError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Invalid AGI response: </span><span class='embexpr_beg'>#{</span><span class='id result'>result</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="inline_return_value-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>inline_return_value</strong>(result) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Parses a response in the form of &#8220;200 result=some_value&#8220;
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


126
127
128
129
130
131
132
133</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/adhearsion/voip/asterisk/commands.rb', line 126</span>

<span class='kw'>def</span> <span class='id inline_return_value'>inline_return_value</span><span class='lparen'>(</span><span class='id result'>result</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>unless</span> <span class='id result'>result</span>
  <span class='kw'>case</span> <span class='id result'>result</span><span class='period'>.</span><span class='id chomp'>chomp</span>
  <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>200 result=0</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>then</span> <span class='kw'>nil</span>
  <span class='kw'>when</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^200 result=(.*)$</span><span class='regexp_end'>/</span></span> <span class='kw'>then</span> <span class='gvar'>$LAST_PAREN_MATCH</span>
  <span class='kw'>else</span> <span class='id raise'>raise</span> <span class='const'>AGIProtocolError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Invalid AGI response: </span><span class='embexpr_beg'>#{</span><span class='id result'>result</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="input-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../String.html" title="String (class)">String</a></span></tt>) <strong>input</strong>(*args, &amp;block) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Used to receive keypad input from the user. Digits are collected via DTMF
(keypad) input until one of three things happens:
</p>
<pre class="code">
 1. The number of digits you specify as the first argument is collected
 2. The timeout you specify with the :timeout option elapses.
 3. The &quot;#&quot; key (or the key you specify with :accept_key) is pressed
</pre>
<p>
Usage examples
</p>
<pre class="code">
  <span class='id input'>input</span>   <span class='comment'># Receives digits until the caller presses the &quot;#&quot; key
</span>  <span class='id input'>input</span> <span class='int'>3</span> <span class='comment'># Receives three digits. Can be 0-9, * or #
</span>  <span class='id input'>input</span> <span class='int'>5</span><span class='comma'>,</span> <span class='symbol'>:accept_key</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>*</span><span class='tstring_end'>&quot;</span></span>   <span class='comment'># Receive at most 5 digits, stopping if '*' is pressed
</span>  <span class='id input'>input</span> <span class='int'>1</span><span class='comma'>,</span> <span class='symbol'>:timeout</span> <span class='op'>=&gt;</span> <span class='int'>1</span><span class='period'>.</span><span class='id minute'>minute</span> <span class='comment'># Receive a single digit, returning an empty
</span>                                  <span class='id string'>string</span> <span class='kw'>if</span> <span class='id the'>the</span> <span class='id timeout'>timeout</span> <span class='id is'>is</span> <span class='id encountered'>encountered</span>
  <span class='id input'>input</span> <span class='int'>9</span><span class='comma'>,</span> <span class='symbol'>:timeout</span> <span class='op'>=&gt;</span> <span class='int'>7</span><span class='comma'>,</span> <span class='symbol'>:accept_key</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>0</span><span class='tstring_end'>&quot;</span></span> <span class='comment'># Receives nine digits, returning
</span>                                             <span class='comment'># when the timeout is encountered
</span>                                             <span class='comment'># or when the &quot;0&quot; key is pressed.
</span>  <span class='id input'>input</span> <span class='int'>3</span><span class='comma'>,</span> <span class='symbol'>:play</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>you-sound-cute</span><span class='tstring_end'>&quot;</span></span>
  <span class='id input'>input</span> <span class='symbol'>:play</span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>if-this-is-correct-press</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>otherwise-press</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>2</span><span class='rbracket'>]</span>
  <span class='id input'>input</span> <span class='symbol'>:interruptible</span> <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='comma'>,</span> <span class='symbol'>:play</span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>you-cannot-interrupt-this-message</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='comment'># Disallow DTMF (keypad) interruption
</span>                                                                                <span class='comment'># until after all files are played.
</span></pre>
<p>
When specifying files to play, the playback of the sequence of files will
stop immediately when the user presses the first digit.
</p>
<p>
The :timeout option works like a digit timeout, therefore each digit
pressed causes the timer to reset. This is a much more user-friendly
approach than an absolute timeout.
</p>
<p>
Note that when the digit limit is not specified the :accept_key becomes
&#8220;#&#8221;. Otherwise there would be no way to end the collection of
digits. You can obviously override this by passing in a new key with
:accept_key.
</p>


  </div>
</div>
<div class="tags">
  <h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
The keypad input received. An empty string is returned in the absense of
input. If the :accept_key argument was pressed, it will not appear in the
output.
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


700
701
702
703
704
705
706
707</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/adhearsion/voip/asterisk/commands.rb', line 700</span>

<span class='kw'>def</span> <span class='id input'>input</span><span class='lparen'>(</span><span class='op'>*</span><span class='id args'>args</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span><span class='rparen'>)</span>
  <span class='kw'>begin</span>
    <span class='id input!'>input!</span> <span class='op'>*</span><span class='id args'>args</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span>
  <span class='kw'>rescue</span> <span class='const'>PlaybackError</span> <span class='op'>=&gt;</span> <span class='id e'>e</span>
    <span class='id ahn_log'>ahn_log</span><span class='period'>.</span><span class='id agi'>agi</span><span class='period'>.</span><span class='id warn'>warn</span> <span class='lbrace'>{</span> <span class='id e'>e</span> <span class='rbrace'>}</span>
    <span class='kw'>retry</span> <span class='comment'># If sound playback fails, play the remaining sound files and wait for digits
</span>  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="input!-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../String.html" title="String (class)">String</a></span></tt>) <strong>input!</strong>(*args, &amp;block) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Same as <span class='object_link'><a href="#input-instance_method" title="Adhearsion::VoIP::Asterisk::Commands#input (method)">#input</a></span>, but immediately raises an exception if sound playback
fails
</p>


  </div>
</div>
<div class="tags">
  <h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
The keypad input received. An empty string is returned in the absense of
input. If the :accept_key argument was pressed, it will not appear in the
output.
</p>
</div>
      
    </li>
  
</ul>
<h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../PlaybackError.html" title="Adhearsion::VoIP::PlaybackError (class)">Adhearsion::VoIP::PlaybackError</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
If a sound file cannot be played
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


713
714
715
716
717
718
719
720
721
722
723
724
725
726
727
728
729
730
731
732
733
734
735
736
737
738
739
740
741
742
743
744
745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/adhearsion/voip/asterisk/commands.rb', line 713</span>

<span class='kw'>def</span> <span class='id input!'>input!</span><span class='lparen'>(</span><span class='op'>*</span><span class='id args'>args</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span><span class='rparen'>)</span>
  <span class='id options'>options</span> <span class='op'>=</span> <span class='id args'>args</span><span class='period'>.</span><span class='id last'>last</span><span class='period'>.</span><span class='id kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Hash</span><span class='rparen'>)</span> <span class='op'>?</span> <span class='id args'>args</span><span class='period'>.</span><span class='id pop'>pop</span> <span class='op'>:</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='id number_of_digits'>number_of_digits</span> <span class='op'>=</span> <span class='id args'>args</span><span class='period'>.</span><span class='id shift'>shift</span>

  <span class='id options'>options</span><span class='lbracket'>[</span><span class='symbol'>:play</span><span class='rbracket'>]</span>  <span class='op'>=</span> <span class='lbracket'>[</span><span class='op'>*</span><span class='id options'>options</span><span class='lbracket'>[</span><span class='symbol'>:play</span><span class='rbracket'>]</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id compact'>compact</span>

  <span class='kw'>if</span> <span class='id options'>options</span><span class='period'>.</span><span class='id has_key?'>has_key?</span><span class='lparen'>(</span><span class='symbol'>:interruptible</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='id options'>options</span><span class='lbracket'>[</span><span class='symbol'>:interruptible</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='kw'>false</span>
    <span class='id play_command'>play_command</span> <span class='op'>=</span> <span class='symbol'>:play!</span>
  <span class='kw'>else</span>
    <span class='id options'>options</span><span class='lbracket'>[</span><span class='symbol'>:interruptible</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>true</span>
    <span class='id play_command'>play_command</span> <span class='op'>=</span> <span class='symbol'>:interruptible_play!</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id options'>options</span><span class='period'>.</span><span class='id has_key?'>has_key?</span> <span class='symbol'>:speak</span>
    <span class='id raise'>raise</span> <span class='const'>ArgumentError</span> <span class='kw'>unless</span> <span class='id options'>options</span><span class='lbracket'>[</span><span class='symbol'>:speak</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id is_a?'>is_a?</span> <span class='const'>Hash</span>
    <span class='id raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Must include a text string when requesting TTS fallback</span><span class='tstring_end'>'</span></span> <span class='kw'>unless</span> <span class='id options'>options</span><span class='lbracket'>[</span><span class='symbol'>:speak</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id has_key?'>has_key?</span><span class='lparen'>(</span><span class='symbol'>:text</span><span class='rparen'>)</span>
    <span class='id options'>options</span><span class='lbracket'>[</span><span class='symbol'>:speak</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:interruptible</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id options'>options</span><span class='lbracket'>[</span><span class='symbol'>:interruptible</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>

  <span class='id timeout'>timeout</span>         <span class='op'>=</span> <span class='id options'>options</span><span class='lbracket'>[</span><span class='symbol'>:timeout</span><span class='rbracket'>]</span>
  <span class='id terminating_key'>terminating_key</span> <span class='op'>=</span> <span class='id options'>options</span><span class='lbracket'>[</span><span class='symbol'>:accept_key</span><span class='rbracket'>]</span>
  <span class='id terminating_key'>terminating_key</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id terminating_key'>terminating_key</span>
    <span class='id terminating_key'>terminating_key</span><span class='period'>.</span><span class='id to_s'>to_s</span>
  <span class='kw'>elsif</span> <span class='id number_of_digits'>number_of_digits</span><span class='period'>.</span><span class='id nil?'>nil?</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id terminating_key'>terminating_key</span><span class='period'>.</span><span class='id equal?'>equal?</span><span class='lparen'>(</span><span class='kw'>false</span><span class='rparen'>)</span>
    <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>#</span><span class='tstring_end'>'</span></span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id number_of_digits'>number_of_digits</span> <span class='op'>&amp;&amp;</span> <span class='id number_of_digits'>number_of_digits</span> <span class='op'>&lt;</span> <span class='int'>0</span>
    <span class='id ahn_log'>ahn_log</span><span class='period'>.</span><span class='id agi'>agi</span><span class='period'>.</span><span class='id warn'>warn</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Giving -1 to #input is now deprecated. Do not specify a first </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span>
                     <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>argument to allow unlimited digits.</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id number_of_digits'>number_of_digits</span> <span class='op'>==</span> <span class='op'>-</span><span class='int'>1</span>
    <span class='id raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>The number of digits must be positive!</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='id buffer'>buffer</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_end'>'</span></span>
  <span class='kw'>if</span> <span class='id options'>options</span><span class='lbracket'>[</span><span class='symbol'>:play</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id any?'>any?</span>
    <span class='kw'>begin</span>
      <span class='comment'># Consume the sound files one at a time. In the event of playback
</span>      <span class='comment'># failure, this tells us which files remain unplayed.
</span>      <span class='kw'>while</span> <span class='id file'>file</span> <span class='op'>=</span> <span class='id options'>options</span><span class='lbracket'>[</span><span class='symbol'>:play</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id shift'>shift</span>
        <span class='id key'>key</span> <span class='op'>=</span> <span class='id send'>send</span> <span class='id play_command'>play_command</span><span class='comma'>,</span> <span class='id file'>file</span>
        <span class='id key'>key</span> <span class='op'>=</span> <span class='kw'>nil</span> <span class='kw'>if</span> <span class='id play_command'>play_command</span> <span class='op'>==</span> <span class='symbol'>:play!</span>
        <span class='kw'>break</span> <span class='kw'>if</span> <span class='id key'>key</span>
      <span class='kw'>end</span>
    <span class='kw'>rescue</span> <span class='const'>PlaybackError</span>
      <span class='id raise'>raise</span> <span class='kw'>unless</span> <span class='id options'>options</span><span class='lbracket'>[</span><span class='symbol'>:speak</span><span class='rbracket'>]</span>
      <span class='id key'>key</span> <span class='op'>=</span> <span class='id speak'>speak</span> <span class='id options'>options</span><span class='lbracket'>[</span><span class='symbol'>:speak</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:text</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id options'>options</span><span class='lbracket'>[</span><span class='symbol'>:speak</span><span class='rbracket'>]</span>
    <span class='kw'>end</span>
    <span class='id key'>key</span> <span class='op'>||=</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_end'>'</span></span>
  <span class='kw'>elsif</span> <span class='id options'>options</span><span class='lbracket'>[</span><span class='symbol'>:speak</span><span class='rbracket'>]</span>
    <span class='id key'>key</span> <span class='op'>=</span> <span class='id speak'>speak</span><span class='lparen'>(</span><span class='id options'>options</span><span class='lbracket'>[</span><span class='symbol'>:speak</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:text</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id options'>options</span><span class='lbracket'>[</span><span class='symbol'>:speak</span><span class='rbracket'>]</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_end'>'</span></span>
  <span class='kw'>else</span>
    <span class='id key'>key</span> <span class='op'>=</span> <span class='id wait_for_digit'>wait_for_digit</span> <span class='id timeout'>timeout</span> <span class='op'>||</span> <span class='op'>-</span><span class='int'>1</span>
  <span class='kw'>end</span>
  <span class='id loop'>loop</span> <span class='kw'>do</span>
    <span class='kw'>return</span> <span class='id buffer'>buffer</span> <span class='kw'>if</span> <span class='id key'>key</span><span class='period'>.</span><span class='id nil?'>nil?</span>
    <span class='kw'>if</span> <span class='id terminating_key'>terminating_key</span>
      <span class='kw'>if</span> <span class='id key'>key</span> <span class='op'>==</span> <span class='id terminating_key'>terminating_key</span>
        <span class='kw'>return</span> <span class='id buffer'>buffer</span>
      <span class='kw'>else</span>
        <span class='id buffer'>buffer</span> <span class='op'>&lt;&lt;</span> <span class='id key'>key</span>
        <span class='kw'>return</span> <span class='id buffer'>buffer</span> <span class='kw'>if</span> <span class='id number_of_digits'>number_of_digits</span> <span class='op'>&amp;&amp;</span> <span class='id number_of_digits'>number_of_digits</span> <span class='op'>==</span> <span class='id buffer'>buffer</span><span class='period'>.</span><span class='id length'>length</span>
      <span class='kw'>end</span>
    <span class='kw'>else</span>
      <span class='id buffer'>buffer</span> <span class='op'>&lt;&lt;</span> <span class='id key'>key</span>
      <span class='kw'>return</span> <span class='id buffer'>buffer</span> <span class='kw'>if</span> <span class='id number_of_digits'>number_of_digits</span> <span class='op'>&amp;&amp;</span> <span class='id number_of_digits'>number_of_digits</span> <span class='op'>==</span> <span class='id buffer'>buffer</span><span class='period'>.</span><span class='id length'>length</span>
    <span class='kw'>end</span>
    <span class='kw'>return</span> <span class='id buffer'>buffer</span> <span class='kw'>if</span> <span class='id block_given?'>block_given?</span> <span class='op'>&amp;&amp;</span> <span class='kw'>yield</span><span class='lparen'>(</span><span class='id buffer'>buffer</span><span class='rparen'>)</span>
    <span class='id key'>key</span> <span class='op'>=</span> <span class='id wait_for_digit'>wait_for_digit</span><span class='lparen'>(</span><span class='id timeout'>timeout</span> <span class='op'>||</span> <span class='op'>-</span><span class='int'>1</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="interruptible_play-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../String.html" title="String (class)">String</a></span></tt><sup>?</sup>) <strong>interruptible_play</strong>(*files) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Play a sequence of files, stopping the playback if a digit is pressed.
</p>


  </div>
</div>
<div class="tags">
  <h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../../String.html" title="String (class)">String</a></span></tt>, <tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
digit pressed, or nil if none
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1245
1246
1247
1248
1249
1250
1251
1252
1253
1254
1255
1256
1257
1258</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/adhearsion/voip/asterisk/commands.rb', line 1245</span>

<span class='kw'>def</span> <span class='id interruptible_play'>interruptible_play</span><span class='lparen'>(</span><span class='op'>*</span><span class='id files'>files</span><span class='rparen'>)</span>
  <span class='id result'>result</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='id files'>files</span><span class='period'>.</span><span class='id flatten'>flatten</span><span class='period'>.</span><span class='id each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id file'>file</span><span class='op'>|</span>
    <span class='kw'>begin</span>
      <span class='id result'>result</span> <span class='op'>=</span> <span class='id interruptible_play!'>interruptible_play!</span><span class='lparen'>(</span><span class='id file'>file</span><span class='rparen'>)</span>
    <span class='kw'>rescue</span> <span class='const'>PlaybackError</span> <span class='op'>=&gt;</span> <span class='id e'>e</span>
      <span class='comment'># Ignore this exception and play the next file
</span>      <span class='id ahn_log'>ahn_log</span><span class='period'>.</span><span class='id agi'>agi</span><span class='period'>.</span><span class='id warn'>warn</span> <span class='id e'>e</span><span class='period'>.</span><span class='id message'>message</span>
    <span class='kw'>ensure</span>
      <span class='kw'>break</span> <span class='kw'>if</span> <span class='id result'>result</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id result'>result</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="interruptible_play!-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../String.html" title="String (class)">String</a></span></tt><sup>?</sup>) <strong>interruptible_play!</strong>(*files) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Same as <span class='object_link'><a href="#interruptible_play-instance_method" title="Adhearsion::VoIP::Asterisk::Commands#interruptible_play (method)">#interruptible_play</a></span>, but immediately raises an exception if a
sound file cannot be played.
</p>


  </div>
</div>
<div class="tags">
  <h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../../String.html" title="String (class)">String</a></span></tt>, <tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
digit pressed, or nil if none
</p>
</div>
      
    </li>
  
</ul>
<h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../PlaybackError.html" title="Adhearsion::VoIP::PlaybackError (class)">Adhearsion::VoIP::PlaybackError</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
If a sound file cannot be played
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1265
1266
1267
1268
1269
1270
1271
1272
1273
1274
1275</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/adhearsion/voip/asterisk/commands.rb', line 1265</span>

<span class='kw'>def</span> <span class='id interruptible_play!'>interruptible_play!</span><span class='lparen'>(</span><span class='op'>*</span><span class='id files'>files</span><span class='rparen'>)</span>
  <span class='id startpos'>startpos</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='id files'>files</span><span class='period'>.</span><span class='id flatten'>flatten</span><span class='period'>.</span><span class='id each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id file'>file</span><span class='op'>|</span>
    <span class='id result'>result</span> <span class='op'>=</span> <span class='id stream_file_result_from'>stream_file_result_from</span> <span class='id response'>response</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>STREAM FILE</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id file'>file</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1234567890*#</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id result'>result</span><span class='lbracket'>[</span><span class='symbol'>:endpos</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id to_i'>to_i</span> <span class='op'>&lt;=</span> <span class='id startpos'>startpos</span>
      <span class='id raise'>raise</span> <span class='const'>Adhearsion</span><span class='op'>::</span><span class='const'>VoIP</span><span class='op'>::</span><span class='const'>PlaybackError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>The sound file could not opened to stream.  The parsed response was </span><span class='embexpr_beg'>#{</span><span class='id result'>result</span><span class='period'>.</span><span class='id inspect'>inspect</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
    <span class='kw'>return</span> <span class='id result'>result</span><span class='lbracket'>[</span><span class='symbol'>:digit</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id result'>result</span><span class='period'>.</span><span class='id has_key?'>has_key?</span> <span class='symbol'>:digit</span>
  <span class='kw'>end</span>
  <span class='kw'>nil</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="join-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>join</strong>(conference_id, options = {}) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Used to join a particular conference with the MeetMe application. To use
MeetMe, be sure you have a proper timing device configured on your Asterisk
box. MeetMe is Asterisk&#8217;s built-in conferencing program.
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>conference_id</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
    </li>
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
    </li>
  
</ul>
<h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
    </li>
  
</ul>

  <h3>See Also:</h3>
  <ul class="see">
    
      <li><a href="http://www.voip-info.org/wiki-Asterisk+cmd+MeetMe" target="_parent" title="Asterisk Meetme Application Information">Asterisk Meetme Application Information</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


983
984
985
986
987
988
989
990
991
992
993
994
995
996</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/adhearsion/voip/asterisk/commands.rb', line 983</span>

<span class='kw'>def</span> <span class='id join'>join</span><span class='lparen'>(</span><span class='id conference_id'>conference_id</span><span class='comma'>,</span> <span class='id options'>options</span><span class='op'>=</span><span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='id conference_id'>conference_id</span> <span class='op'>=</span> <span class='id conference_id'>conference_id</span><span class='period'>.</span><span class='id to_s'>to_s</span><span class='period'>.</span><span class='id scan'>scan</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\w</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id join'>join</span>
  <span class='id command_flags'>command_flags</span> <span class='op'>=</span> <span class='id options'>options</span><span class='lbracket'>[</span><span class='symbol'>:options</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id to_s'>to_s</span> <span class='comment'># This is a passthrough string straight to Asterisk
</span>  <span class='id pin'>pin</span> <span class='op'>=</span> <span class='id options'>options</span><span class='lbracket'>[</span><span class='symbol'>:pin</span><span class='rbracket'>]</span>
  <span class='id raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>A conference PIN number must be numerical!</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id pin'>pin</span> <span class='op'>&amp;&amp;</span> <span class='id pin'>pin</span><span class='period'>.</span><span class='id to_s'>to_s</span> <span class='op'>!~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^\d+$</span><span class='regexp_end'>/</span></span>

  <span class='comment'># To disable dynamic conference creation set :use_static_conf =&gt; true
</span>  <span class='id use_static_conf'>use_static_conf</span> <span class='op'>=</span> <span class='id options'>options</span><span class='period'>.</span><span class='id has_key?'>has_key?</span><span class='lparen'>(</span><span class='symbol'>:use_static_conf</span><span class='rparen'>)</span> <span class='op'>?</span> <span class='id options'>options</span><span class='lbracket'>[</span><span class='symbol'>:use_static_conf</span><span class='rbracket'>]</span> <span class='op'>:</span> <span class='kw'>false</span>

  <span class='comment'># The 'd' option of MeetMe creates conferences dynamically.
</span>  <span class='id command_flags'>command_flags</span> <span class='op'>+=</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>d</span><span class='tstring_end'>'</span></span> <span class='kw'>unless</span> <span class='lparen'>(</span><span class='id command_flags'>command_flags</span><span class='period'>.</span><span class='id include?'>include?</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>d</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span> <span class='kw'>or</span> <span class='id use_static_conf'>use_static_conf</span><span class='rparen'>)</span>

  <span class='id execute'>execute</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>MeetMe</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id conference_id'>conference_id</span><span class='comma'>,</span> <span class='id command_flags'>command_flags</span><span class='comma'>,</span> <span class='id options'>options</span><span class='lbracket'>[</span><span class='symbol'>:pin</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="jump_to-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>jump_to</strong>(context, overrides = {}) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Jumps to a context. An alternative to DialplanContextProc#+@. When jumping
to a context, it will <b>not</b> resume executing the former context when
the jumped-to context has finished executing. Make sure you don&#8217;t
have any <tt>ensure</tt> closures which you expect to execute when the call
has finished, as they will run when this method is called.
</p>
<p>
You can optionally override certain dialplan variables when jumping to the
context. A popular use of this is to redefine <tt>extension</tt> (which
this method automatically boxes with a PhoneNumber object) so you can
effectively &#8220;restart&#8221; a call (from the perspective of the
jumped-to context). When you override variables here, you&#8217;re
effectively blowing away the old variables. If you need them for some
reason, you should assign the important ones to an instance variable first
before calling this method.
</p>


  </div>
</div>
<div class="tags">
  <h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../DSL/Dialplan/ControlPassingException.html" title="Adhearsion::VoIP::DSL::Dialplan::ControlPassingException (class)">Adhearsion::VoIP::DSL::Dialplan::ControlPassingException</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/adhearsion/voip/asterisk/commands.rb', line 794</span>

<span class='kw'>def</span> <span class='id jump_to'>jump_to</span><span class='lparen'>(</span><span class='id context'>context</span><span class='comma'>,</span> <span class='id overrides'>overrides</span><span class='op'>=</span><span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='id context'>context</span> <span class='op'>=</span> <span class='id lookup_context_with_name'>lookup_context_with_name</span><span class='lparen'>(</span><span class='id context'>context</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id context'>context</span><span class='period'>.</span><span class='id kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Symbol</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='lparen'>(</span><span class='id context'>context</span><span class='period'>.</span><span class='id kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='id context'>context</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^[\w_]+$</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span>

  <span class='comment'># JRuby has a bug that prevents us from correctly determining the class name.
</span>  <span class='comment'># See: http://jira.codehaus.org/browse/JRUBY-5026
</span>  <span class='kw'>if</span> <span class='op'>!</span><span class='lparen'>(</span><span class='id context'>context</span><span class='period'>.</span><span class='id kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Adhearsion</span><span class='op'>::</span><span class='const'>DialPlan</span><span class='op'>::</span><span class='const'>DialplanContextProc</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='id context'>context</span><span class='period'>.</span><span class='id kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Proc</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='id raise'>raise</span> <span class='const'>Adhearsion</span><span class='op'>::</span><span class='const'>VoIP</span><span class='op'>::</span><span class='const'>DSL</span><span class='op'>::</span><span class='const'>Dialplan</span><span class='op'>::</span><span class='const'>ContextNotFoundException</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id overrides'>overrides</span><span class='period'>.</span><span class='id any?'>any?</span>
    <span class='id overrides'>overrides</span> <span class='op'>=</span> <span class='id overrides'>overrides</span><span class='period'>.</span><span class='id symbolize_keys'>symbolize_keys</span>
    <span class='kw'>if</span> <span class='id overrides'>overrides</span><span class='period'>.</span><span class='id has_key?'>has_key?</span><span class='lparen'>(</span><span class='symbol'>:extension</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id overrides'>overrides</span><span class='lbracket'>[</span><span class='symbol'>:extension</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Adhearsion</span><span class='op'>::</span><span class='const'>VoIP</span><span class='op'>::</span><span class='const'>DSL</span><span class='op'>::</span><span class='const'>PhoneNumber</span><span class='rparen'>)</span>
      <span class='id overrides'>overrides</span><span class='lbracket'>[</span><span class='symbol'>:extension</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>Adhearsion</span><span class='op'>::</span><span class='const'>VoIP</span><span class='op'>::</span><span class='const'>DSL</span><span class='op'>::</span><span class='const'>PhoneNumber</span><span class='period'>.</span><span class='id new'>new</span> <span class='id overrides'>overrides</span><span class='lbracket'>[</span><span class='symbol'>:extension</span><span class='rbracket'>]</span>
    <span class='kw'>end</span>

    <span class='id overrides'>overrides</span><span class='period'>.</span><span class='id each_pair'>each_pair</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id key'>key</span><span class='comma'>,</span> <span class='id value'>value</span><span class='op'>|</span>
      <span class='id meta_def'>meta_def</span><span class='lparen'>(</span><span class='id key'>key</span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='id value'>value</span> <span class='rbrace'>}</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='id raise'>raise</span> <span class='const'>Adhearsion</span><span class='op'>::</span><span class='const'>VoIP</span><span class='op'>::</span><span class='const'>DSL</span><span class='op'>::</span><span class='const'>Dialplan</span><span class='op'>::</span><span class='const'>ControlPassingException</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='id context'>context</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="last_dial_status-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>last_dial_status</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Get the status of the last dial(). Possible dial statuses include :answer,
:busy, :no_answer, :cancelled, :congested, and :channel_unavailable. If
:cancel is returned, the caller hung up before the callee picked up. If
:congestion is returned, the dialed extension probably doesn&#8217;t exist.
If :channel_unavailable, the callee phone may not be registered.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


844
845
846</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/adhearsion/voip/asterisk/commands.rb', line 844</span>

<span class='kw'>def</span> <span class='id last_dial_status'>last_dial_status</span>
  <span class='const'>DIAL_STATUSES</span><span class='lbracket'>[</span><span class='id get_dial_status'>get_dial_status</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="last_dial_successful?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>last_dial_successful?</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
as reported by Asterisk. false otherwise
</p>


  </div>
</div>
<div class="tags">
  <h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
true if your last call to dial() finished with the ANSWER state,
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


850
851
852</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/adhearsion/voip/asterisk/commands.rb', line 850</span>

<span class='kw'>def</span> <span class='id last_dial_successful?'>last_dial_successful?</span>
  <span class='id last_dial_status'>last_dial_status</span> <span class='op'>==</span> <span class='symbol'>:answered</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="last_dial_unsuccessful?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>last_dial_unsuccessful?</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Opposite of last_dial_successful?()
</p>


  </div>
</div>
<div class="tags">
  <h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


855
856
857</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/adhearsion/voip/asterisk/commands.rb', line 855</span>

<span class='kw'>def</span> <span class='id last_dial_unsuccessful?'>last_dial_unsuccessful?</span>
  <span class='kw'>not</span> <span class='id last_dial_successful?'>last_dial_successful?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="menu-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>menu</strong>(*args, &amp;block) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Creates an interactive menu for the caller.
</p>
<p>
The following documentation was derived from a post on Jay Phillips&#8217;
blog (see below).
</p>
<p>
The menu() command solves the problem of building enormous input-fetching
state machines in Ruby without first-class message passing facilities or an
external DSL.
</p>
<p>
Here is an example dialplan which uses the menu() command effectively.
</p>
<pre class="code">
  <span class='id from_pstn'>from_pstn</span> <span class='lbrace'>{</span>
    <span class='id menu'>menu</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>welcome</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>for-spanish-press-8</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>main-ivr</span><span class='tstring_end'>'</span></span><span class='comma'>,</span>
         <span class='symbol'>:timeout</span> <span class='op'>=&gt;</span> <span class='int'>8</span><span class='period'>.</span><span class='id seconds'>seconds</span><span class='comma'>,</span> <span class='symbol'>:tries</span> <span class='op'>=&gt;</span> <span class='int'>3</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id link'>link</span><span class='op'>|</span>
      <span class='id link'>link</span><span class='period'>.</span><span class='id shipment_status'>shipment_status</span>  <span class='int'>1</span>
      <span class='id link'>link</span><span class='period'>.</span><span class='id ordering'>ordering</span>         <span class='int'>2</span>
      <span class='id link'>link</span><span class='period'>.</span><span class='id representative'>representative</span>   <span class='int'>4</span>
      <span class='id link'>link</span><span class='period'>.</span><span class='id spanish'>spanish</span>          <span class='int'>8</span>
      <span class='id link'>link</span><span class='period'>.</span><span class='id employee'>employee</span>         <span class='int'>900</span><span class='op'>..</span><span class='int'>999</span>

      <span class='id link'>link</span><span class='period'>.</span><span class='id on_invalid'>on_invalid</span> <span class='lbrace'>{</span> <span class='id play'>play</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>invalid</span><span class='tstring_end'>'</span></span> <span class='rbrace'>}</span>

      <span class='id link'>link</span><span class='period'>.</span><span class='id on_premature_timeout'>on_premature_timeout</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id str'>str</span><span class='op'>|</span>
        <span class='id play'>play</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>sorry</span><span class='tstring_end'>'</span></span>
      <span class='kw'>end</span>

      <span class='id link'>link</span><span class='period'>.</span><span class='id on_failure'>on_failure</span> <span class='kw'>do</span>
        <span class='id play'>play</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>goodbye</span><span class='tstring_end'>'</span></span>
        <span class='id hangup'>hangup</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='rbrace'>}</span>

  <span class='id shipment_status'>shipment_status</span> <span class='lbrace'>{</span>
    <span class='comment'># Fetch a tracking number and pass it to a web service.
</span>  <span class='rbrace'>}</span>

  <span class='id ordering'>ordering</span> <span class='lbrace'>{</span>
    <span class='comment'># Enter another menu that lets them enter credit card
</span>    <span class='comment'># information and place their order over the phone.
</span>  <span class='rbrace'>}</span>

  <span class='id representative'>representative</span> <span class='lbrace'>{</span>
    <span class='comment'># Place the caller into a queue
</span>  <span class='rbrace'>}</span>

  <span class='id spanish'>spanish</span> <span class='lbrace'>{</span>
    <span class='comment'># Special options for the spanish menu.
</span>  <span class='rbrace'>}</span>

  <span class='id employee'>employee</span> <span class='lbrace'>{</span>
    <span class='id dial'>dial</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SIP/</span><span class='embexpr_beg'>#{</span><span class='id extension'>extension</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span> <span class='comment'># Overly simplistic
</span>  <span class='rbrace'>}</span>
</pre>
<p>
The main detail to note is the declarations within the menu() command???s
block. Each line seems to refer to a link object executing a seemingly
arbitrary method with an argument that???s either a number or a Range of
numbers. The <tt>link</tt> object collects these arbitrary method
invocations and assembles a set of rules. The seemingly arbitrary method
name is the name of the context to which the menu should jump in case its
argument (the pattern) is found to be a match.
</p>
<p>
With these context names and patterns defined, the <tt>menu()</tt> command plays
in sequence the sound files you supply as arguments, stopping playback
abruptly if the user enters a digit. If no digits were pressed when the
files finish playing, it waits <tt>:timeout</tt> seconds. If no digits are
pressed after the timeout, it executes the <tt>on_premature_timeout</tt>
hook you define (if any) and then tries again a maximum of <tt>:tries</tt>
times. If digits are pressed that result in no possible match, it executes
the <tt>on_invalid</tt> hook. When/if all tries are exhausted with no
positive match, it executes the <tt>on_failure</tt> hook after the other
hook (e.g. <tt>on_invalid</tt>, then <tt>on_failure</tt>).
</p>
<p>
When the <tt>menu()</tt> state machine runs through the defined rules, it must
distinguish between exact and potential matches. It&#8217;s important to
understand the differences between these and how they affect the overall
outcome:
</p>
<pre class="code">
  |---------------|-------------------|------------------------------------------------------|
  | exact matches | potential matches | result                                               |
  |---------------|-------------------|------------------------------------------------------|
  |  0            |  0                 | Fail and start over                                  |
  |  1            |  0                 | Match found!                                         |
  |  0            | &gt;0                 | Get another digit                                    |
  | &gt;1            |  0                 | Go with the first exact match                        |
  |  1            | &gt;0                 | Get another digit. If timeout, use exact match       |
  | &gt;1            | &gt;0                 | Get another digit. If timeout, use first exact match |
  |---------------|-------------------|------------------------------------------------------|
</pre>
<h2>Database integration</h2>
<p>
To do database integration, I recommend programatically executing methods
on the link object within the block. For example:
</p>
<pre class="code">
  <span class='id menu'>menu</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id link'>link</span><span class='op'>|</span>
    <span class='kw'>for</span> <span class='id employee'>employee</span> <span class='kw'>in</span> <span class='const'>Employee</span><span class='period'>.</span><span class='id find'>find</span><span class='lparen'>(</span><span class='symbol'>:all</span><span class='rparen'>)</span>
      <span class='id link'>link</span><span class='period'>.</span><span class='id internal'>internal</span> <span class='id employee'>employee</span><span class='period'>.</span><span class='id extension'>extension</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
</pre>
<p>
or this more efficient and Rubyish way
</p>
<pre class="code">
  <span class='id menu'>menu</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id link'>link</span><span class='op'>|</span>
    <span class='id link'>link</span><span class='period'>.</span><span class='id internal'>internal</span> <span class='op'>*</span><span class='const'>Employee</span><span class='period'>.</span><span class='id find'>find</span><span class='lparen'>(</span><span class='symbol'>:all</span><span class='rparen'>)</span><span class='period'>.</span><span class='id map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:extension</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
</pre>
<p>
If this second example seems like too much Ruby magic, let me explain ???
<tt>Employee.find(:all)</tt> effectively does a ???SELECT * FROM employees??? on
the database with ActiveRecord, returning (what you???d think is) an Array.
The <tt>map(&amp;amp;:extension)</tt> is fanciness that means ???replace every
instance in this Array with the result of calling extension on that
object???. Now we have an Array of every extension in the database. The
splat operator (*) before the argument changes the argument from being one
argument (an Array) into a sequence of n arguments, where n is the number
of items in the Array it???s ???splatting???. Lastly, these arguments are
passed to the internal method, the name of a context which will handle
dialing this user if one of the supplied patterns matches.
</p>
<h2>Handling a successful pattern match</h2>
<p>
Which brings me to another important note. Let???s say that the user???s
input successfully matched one of the patterns returned by that
Employe.find&#8230; magic. When it jumps to the internal context, that
context can access the variable entered through the extension variable.
This was a tricky design decision that I think, overall, works great. It
makes the <tt>menu()</tt> command feel much more first-class in the Adhearsion
dialplan grammar and decouples the receiving context from the menu that
caused the jump. After all, the context doesn???t necessary need to be the
endpoint from a menu; it can be its own entry point, making menu()
effectively a pipeline of re-creating the call.
</p>


  </div>
</div>
<div class="tags">
  
  <h3>See Also:</h3>
  <ul class="see">
    
      <li><a href="http://jicksta.com/articles/2008/02/11/menu-command" target="_parent" title="Original Blog Post">Original Blog Post</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/adhearsion/voip/asterisk/commands.rb', line 611</span>

<span class='kw'>def</span> <span class='id menu'>menu</span><span class='lparen'>(</span><span class='op'>*</span><span class='id args'>args</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span><span class='rparen'>)</span>
  <span class='id options'>options</span> <span class='op'>=</span> <span class='id args'>args</span><span class='period'>.</span><span class='id last'>last</span><span class='period'>.</span><span class='id kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Hash</span><span class='rparen'>)</span> <span class='op'>?</span> <span class='id args'>args</span><span class='period'>.</span><span class='id pop'>pop</span> <span class='op'>:</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='id sound_files'>sound_files</span> <span class='op'>=</span> <span class='id args'>args</span><span class='period'>.</span><span class='id flatten'>flatten</span>

  <span class='id menu_instance'>menu_instance</span> <span class='op'>=</span> <span class='const'>Menu</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='id options'>options</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id block'>block</span><span class='rparen'>)</span>

  <span class='id initial_digit_prompt'>initial_digit_prompt</span> <span class='op'>=</span> <span class='id sound_files'>sound_files</span><span class='period'>.</span><span class='id any?'>any?</span>

  <span class='comment'># This method is basically one big begin/rescue block. When we start the Menu state machine by continue()ing, the state
</span>  <span class='comment'># machine will pass messages back to this method in the form of Exceptions. This decoupling allows the menu system to
</span>  <span class='comment'># work on, say, Freeswitch and Asterisk both.
</span>  <span class='kw'>begin</span>
    <span class='kw'>if</span> <span class='id menu_instance'>menu_instance</span><span class='period'>.</span><span class='id should_continue?'>should_continue?</span>
      <span class='id menu_instance'>menu_instance</span><span class='period'>.</span><span class='id continue'>continue</span>
    <span class='kw'>else</span>
      <span class='id menu_instance'>menu_instance</span><span class='period'>.</span><span class='id execute_failure_hook'>execute_failure_hook</span>
      <span class='kw'>return</span> <span class='symbol'>:failed</span>
    <span class='kw'>end</span>
  <span class='kw'>rescue</span> <span class='const'>Menu</span><span class='op'>::</span><span class='const'>MenuResult</span> <span class='op'>=&gt;</span> <span class='id result_of_menu'>result_of_menu</span>
    <span class='kw'>case</span> <span class='id result_of_menu'>result_of_menu</span>
      <span class='kw'>when</span> <span class='const'>Menu</span><span class='op'>::</span><span class='const'>MenuResultInvalid</span>
        <span class='id menu_instance'>menu_instance</span><span class='period'>.</span><span class='id execute_invalid_hook'>execute_invalid_hook</span>
        <span class='id menu_instance'>menu_instance</span><span class='period'>.</span><span class='id restart!'>restart!</span>
      <span class='kw'>when</span> <span class='const'>Menu</span><span class='op'>::</span><span class='const'>MenuGetAnotherDigit</span>

        <span class='id next_digit'>next_digit</span> <span class='op'>=</span> <span class='id play_sound_files_for_menu'>play_sound_files_for_menu</span><span class='lparen'>(</span><span class='id menu_instance'>menu_instance</span><span class='comma'>,</span> <span class='id sound_files'>sound_files</span><span class='rparen'>)</span>
        <span class='kw'>if</span> <span class='id next_digit'>next_digit</span>
          <span class='id menu_instance'>menu_instance</span> <span class='op'>&lt;&lt;</span> <span class='id next_digit'>next_digit</span>
        <span class='kw'>else</span>
          <span class='comment'># The user timed out entering another digit!
</span>          <span class='kw'>case</span> <span class='id result_of_menu'>result_of_menu</span>
            <span class='kw'>when</span> <span class='const'>Menu</span><span class='op'>::</span><span class='const'>MenuGetAnotherDigitOrFinish</span>
              <span class='comment'># This raises a ControlPassingException
</span>              <span class='id jump_to'>jump_to</span> <span class='id result_of_menu'>result_of_menu</span><span class='period'>.</span><span class='id match_payload'>match_payload</span><span class='comma'>,</span> <span class='symbol'>:extension</span> <span class='op'>=&gt;</span> <span class='id result_of_menu'>result_of_menu</span><span class='period'>.</span><span class='id new_extension'>new_extension</span>
            <span class='kw'>when</span> <span class='const'>Menu</span><span class='op'>::</span><span class='const'>MenuGetAnotherDigitOrTimeout</span>
              <span class='comment'># This should execute premature_timeout AND reset if the number of retries
</span>              <span class='comment'># has not been exhausted.
</span>              <span class='id menu_instance'>menu_instance</span><span class='period'>.</span><span class='id execute_timeout_hook'>execute_timeout_hook</span>
              <span class='id menu_instance'>menu_instance</span><span class='period'>.</span><span class='id restart!'>restart!</span>
          <span class='kw'>end</span>
        <span class='kw'>end</span>
      <span class='kw'>when</span> <span class='const'>Menu</span><span class='op'>::</span><span class='const'>MenuResultFound</span>
        <span class='id jump_to'>jump_to</span> <span class='id result_of_menu'>result_of_menu</span><span class='period'>.</span><span class='id match_payload'>match_payload</span><span class='comma'>,</span> <span class='symbol'>:extension</span> <span class='op'>=&gt;</span> <span class='id result_of_menu'>result_of_menu</span><span class='period'>.</span><span class='id new_extension'>new_extension</span>
      <span class='kw'>else</span>
        <span class='id raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unrecognized MenuResult! This may be a bug!</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>

    <span class='comment'># Retry will re-execute the begin block, preserving our changes to the menu_instance object.
</span>    <span class='kw'>retry</span>

  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="messages_waiting?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>messages_waiting?</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
This command should be used to check if a message is waiting on the
Asterisk Comedian Voicemail application.
</p>


  </div>
</div>
<div class="tags">
  <h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


495
496
497</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/adhearsion/voip/asterisk/commands.rb', line 495</span>

<span class='kw'>def</span> <span class='id messages_waiting?'>messages_waiting?</span>
  <span class='kw'>not</span> <span class='ivar'>@call</span><span class='period'>.</span><span class='id inbox'>inbox</span><span class='period'>.</span><span class='id empty?'>empty?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="next_message-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>next_message</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
This command should be used to advance to the next message in the Asterisk
Comedian Voicemail application
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


490
491
492</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/adhearsion/voip/asterisk/commands.rb', line 490</span>

<span class='kw'>def</span> <span class='id next_message'>next_message</span>
  <span class='ivar'>@call</span><span class='period'>.</span><span class='id inbox'>inbox</span><span class='period'>.</span><span class='id pop'>pop</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="play-instance_method">
  
    - (<tt>Boolean</tt>) <strong>play</strong>(*arguments) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Plays the specified sound file names. This method will handle Time/DateTime
objects (e.g. Time.now), Fixnums (e.g. 1000), Strings which are valid
Fixnums (e.g &#8220;123&#8221;), and direct sound files. When playing
numbers, Adhearsion assumes you&#8217;re saying the number, not the digits.
For example, play(&#8220;100&#8221;) is pronounced as &#8220;one
hundred&#8221; instead of &#8220;one zero zero&#8221;. To specify how the
Date/Time objects are said pass in as an array with the first parameter as
the Date/Time/DateTime object along with a hash with the additional
options.  See play_time for more information.
</p>
<p>
Note: it is not necessary to supply a sound file extension; Asterisk will
try to find a sound file encoded using the current channel&#8217;s codec,
if one exists. If not, it will transcode from the default codec (GSM).
Asterisk stores its sound files in /var/lib/asterisk/sounds.
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h3>Examples:</h3>
    
      <h4><div class='inline'><p>
Play file hello-world.???
</p>
</div></h4>
      <pre class="example code"><span class='id play'>play</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>hello-world</span><span class='tstring_end'>'</span></span></pre>
    
      <h4><div class='inline'><p>
Speak current time
</p>
</div></h4>
      <pre class="example code"><span class='id play'>play</span> <span class='const'>Time</span><span class='period'>.</span><span class='id now'>now</span></pre>
    
      <h4><div class='inline'><p>
Speak today&#8217;s date
</p>
</div></h4>
      <pre class="example code"><span class='id play'>play</span> <span class='const'>Date</span><span class='period'>.</span><span class='id today'>today</span></pre>
    
      <h4><div class='inline'><p>
Speak today&#8217;s date in a specific format
</p>
</div></h4>
      <pre class="example code"><span class='id play'>play</span> <span class='lbracket'>[</span><span class='const'>Date</span><span class='period'>.</span><span class='id today'>today</span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='symbol'>:format</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>BdY</span><span class='tstring_end'>'</span></span><span class='rbrace'>}</span><span class='rbracket'>]</span></pre>
    
      <h4><div class='inline'><p>
Play sound file, speak number, play two more sound files
</p>
</div></h4>
      <pre class="example code"><span class='id play'>play</span> <span class='qwords_beg'>%w&quot;</span><span class='tstring_content'>a-connect-charge-of</span><span class='words_sep'> </span><span class='tstring_content'>22</span><span class='words_sep'> </span><span class='tstring_content'>cents-per-minute</span><span class='words_sep'> </span><span class='tstring_content'>will-apply</span><span class='words_sep'>&quot;</span></pre>
    
      <h4><div class='inline'><p>
Play two sound files
</p>
</div></h4>
      <pre class="example code"><span class='id play'>play</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>you-sound-cute</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>what-are-you-wearing</span><span class='tstring_end'>&quot;</span></span></pre>
    
  </div>
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
true is returned if everything was successful.  Otherwise, false indicates
that some sound file(s) could not be played.
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


231
232
233
234
235
236
237
238
239
240
241</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/adhearsion/voip/asterisk/commands.rb', line 231</span>

<span class='kw'>def</span> <span class='id play'>play</span><span class='lparen'>(</span><span class='op'>*</span><span class='id arguments'>arguments</span><span class='rparen'>)</span>
  <span class='id result'>result</span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='kw'>unless</span> <span class='id play_time'>play_time</span><span class='lparen'>(</span><span class='id arguments'>arguments</span><span class='rparen'>)</span>
    <span class='id arguments'>arguments</span><span class='period'>.</span><span class='id flatten'>flatten</span><span class='period'>.</span><span class='id each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id argument'>argument</span><span class='op'>|</span>
      <span class='comment'># result starts off as true.  But if the following command ever returns false, then result
</span>      <span class='comment'># remains false.
</span>      <span class='id result'>result</span> <span class='op'>&amp;=</span> <span class='id play_numeric'>play_numeric</span><span class='lparen'>(</span><span class='id argument'>argument</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='id play_soundfile'>play_soundfile</span><span class='lparen'>(</span><span class='id argument'>argument</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id result'>result</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="play!-instance_method">
  
    - (<tt>true</tt>) <strong>play!</strong>(*arguments) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Same as <span class='object_link'><a href="#play-instance_method" title="Adhearsion::VoIP::Asterisk::Commands#play (method)">#play</a></span>, but immediately raises an exception if a sound file cannot
be played.
</p>


  </div>
</div>
<div class="tags">
  <h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>true</tt>)</span>
      
      
      
    </li>
  
</ul>
<h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../PlaybackError.html" title="Adhearsion::VoIP::PlaybackError (class)">Adhearsion::VoIP::PlaybackError</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
If a sound file cannot be played
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


247
248
249
250
251
252
253
254</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/adhearsion/voip/asterisk/commands.rb', line 247</span>

<span class='kw'>def</span> <span class='id play!'>play!</span><span class='lparen'>(</span><span class='op'>*</span><span class='id arguments'>arguments</span><span class='rparen'>)</span>
  <span class='kw'>unless</span> <span class='id play_time'>play_time</span><span class='lparen'>(</span><span class='id arguments'>arguments</span><span class='rparen'>)</span>
    <span class='id arguments'>arguments</span><span class='period'>.</span><span class='id flatten'>flatten</span><span class='period'>.</span><span class='id each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id argument'>argument</span><span class='op'>|</span>
      <span class='id play_numeric'>play_numeric</span><span class='lparen'>(</span><span class='id argument'>argument</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='id play_soundfile!'>play_soundfile!</span><span class='lparen'>(</span><span class='id argument'>argument</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='kw'>true</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="play_or_speak-instance_method">
  
    - (<tt>true</tt>) <strong>play_or_speak</strong>(prompts) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Attempts to play a sound prompt.  If the prompt is unplayable, for example,
if the file is not present, then attempt to speak the prompt using
Text-To-Speech.
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h3>Examples:</h3>
    
      <h4><div class='inline'><p>
Play &#8220;tt-monkeys&#8221; or say &#8220;Ooh ooh eee eee eee&#8220;
</p>
</div></h4>
      <pre class="example code"><span class='id play_or_speak'>play_or_speak</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>tt-monkeys</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span><span class='symbol'>:text</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Ooh ooh eee eee eee</span><span class='tstring_end'>&quot;</span></span><span class='rbrace'>}</span></pre>
    
      <h4><div class='inline'><p>
Play &#8220;pbx-invalid&#8221; or say &#8220;I&#8217;m sorry, that is not a
valid extension. Please try again.&#8221; and allowing the user to
interrupt the TTS with &#8220;#&#8220;
</p>
</div></h4>
      <pre class="example code"><span class='id play_or_speak'>play_or_speak</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>pbx-invalid</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span><span class='symbol'>:text</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>I'm sorry, that is not a valid extension.  Please try again</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:engine</span> <span class='op'>=&gt;</span> <span class='symbol'>:unimrcp</span><span class='rbrace'>}</span></pre>
    
  </div>
<h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>Map</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
of prompts and fallback TTS options
</p>
</div>
      
    </li>
  
</ul>
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>true</tt>)</span>
      
      
      
    </li>
  
</ul>
<h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
If prompt cannot be found and TTS text is not specified
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/adhearsion/voip/asterisk/commands.rb', line 269</span>

<span class='kw'>def</span> <span class='id play_or_speak'>play_or_speak</span><span class='lparen'>(</span><span class='id prompts'>prompts</span><span class='rparen'>)</span>
 <span class='id interrupted'>interrupted</span> <span class='op'>=</span> <span class='kw'>nil</span>
 <span class='kw'>unless</span> <span class='id interrupted'>interrupted</span>
   <span class='id prompts'>prompts</span><span class='period'>.</span><span class='id each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id filename'>filename</span><span class='comma'>,</span> <span class='id options'>options</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='id filename'>filename</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id filename'>filename</span><span class='period'>.</span><span class='id empty?'>empty?</span>
      <span class='kw'>begin</span>
        <span class='kw'>if</span> <span class='id options'>options</span><span class='lbracket'>[</span><span class='symbol'>:interruptible</span><span class='rbracket'>]</span>
          <span class='id interrupted'>interrupted</span> <span class='op'>=</span> <span class='id interruptible_play!'>interruptible_play!</span> <span class='id filename'>filename</span>
        <span class='kw'>else</span>
          <span class='id play!'>play!</span> <span class='id filename'>filename</span>
        <span class='kw'>end</span>
      <span class='kw'>rescue</span> <span class='const'>PlaybackError</span>
        <span class='id raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Must supply TTS text as fallback</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='id options'>options</span><span class='lbracket'>[</span><span class='symbol'>:text</span><span class='rbracket'>]</span>
        <span class='id interrupted'>interrupted</span> <span class='op'>=</span> <span class='id speak'>speak</span> <span class='id options'>options</span><span class='period'>.</span><span class='id delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:text</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id options'>options</span>
      <span class='kw'>end</span>
    <span class='kw'>else</span>
      <span class='id interrupted'>interrupted</span> <span class='op'>=</span> <span class='id speak'>speak</span> <span class='id options'>options</span><span class='period'>.</span><span class='id delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:text</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id options'>options</span>
    <span class='kw'>end</span>
   <span class='kw'>end</span>
 <span class='kw'>end</span>
 <span class='id interrupted'>interrupted</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="play_time-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>play_time</strong>(*args) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Plays the given Date, Time, or Integer (seconds since epoch) using the
given timezone and format.
</p>
<p>
<tt>:timezone</tt> - Sends a timezone to asterisk. See /usr/share/zoneinfo
for a list. Defaults to the machine timezone. <tt>:format</tt>   - This is
the format the time is to be said in.  Defaults to &#8220;ABdY
&#8216;digits/at&#8217; IMp&#8220;
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>Time</span>
      
      
        <span class='type'>(<tt>Date|Time|DateTime</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
to be said.
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>Additional</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
options to specify how exactly to say time specified.
</p>
</div>
      
    </li>
  
</ul>

  <h3>See Also:</h3>
  <ul class="see">
    
      <li><a href="http://www.voip-info.org/wiki/view/Asterisk+cmd+SayUnixTime" target="_parent" title="http://www.voip-info.org/wiki/view/Asterisk+cmd+SayUnixTime">http://www.voip-info.org/wiki/view/Asterisk+cmd+SayUnixTime</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1312
1313
1314
1315
1316
1317
1318
1319
1320
1321
1322
1323
1324
1325
1326
1327
1328
1329
1330
1331</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/adhearsion/voip/asterisk/commands.rb', line 1312</span>

<span class='kw'>def</span> <span class='id play_time'>play_time</span><span class='lparen'>(</span><span class='op'>*</span><span class='id args'>args</span><span class='rparen'>)</span>
  <span class='id argument'>argument</span><span class='comma'>,</span> <span class='id options'>options</span> <span class='op'>=</span> <span class='id args'>args</span><span class='period'>.</span><span class='id flatten'>flatten</span>
  <span class='id options'>options</span> <span class='op'>||=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>

  <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>unless</span> <span class='id options'>options</span><span class='period'>.</span><span class='id is_a?'>is_a?</span> <span class='const'>Hash</span>

  <span class='id timezone'>timezone</span> <span class='op'>=</span> <span class='id options'>options</span><span class='period'>.</span><span class='id delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:timezone</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_end'>'</span></span>
  <span class='id format'>format</span>   <span class='op'>=</span> <span class='id options'>options</span><span class='period'>.</span><span class='id delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:format</span><span class='rparen'>)</span>   <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_end'>'</span></span>
  <span class='id epoch'>epoch</span>    <span class='op'>=</span> <span class='kw'>case</span> <span class='id argument'>argument</span>
             <span class='kw'>when</span> <span class='const'>Time</span> <span class='op'>||</span> <span class='const'>DateTime</span>
               <span class='id argument'>argument</span><span class='period'>.</span><span class='id to_i'>to_i</span>
             <span class='kw'>when</span> <span class='const'>Date</span>
               <span class='id format'>format</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>BdY</span><span class='tstring_end'>'</span></span> <span class='kw'>unless</span> <span class='id format'>format</span><span class='period'>.</span><span class='id present?'>present?</span>
               <span class='id argument'>argument</span><span class='period'>.</span><span class='id to_time'>to_time</span><span class='period'>.</span><span class='id to_i'>to_i</span>
             <span class='kw'>end</span>

  <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='id epoch'>epoch</span><span class='period'>.</span><span class='id nil?'>nil?</span>

  <span class='id execute'>execute</span> <span class='symbol'>:sayunixtime</span><span class='comma'>,</span> <span class='id epoch'>epoch</span><span class='comma'>,</span> <span class='id timezone'>timezone</span><span class='comma'>,</span> <span class='id format'>format</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="queue-instance_method">
  
    - (<tt><span class='object_link'><a href="Commands/QueueProxy.html" title="Adhearsion::VoIP::Asterisk::Commands::QueueProxy (class)">Adhearsion::VoIP::Asterisk::Commands::QueueProxy</a></span></tt>) <strong>queue</strong>(queue_name) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Place a call in a queue to be answered by a registered agent. You must then
call join!()
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>queue_name</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the queue name to place the caller in
</p>
</div>
      
    </li>
  
</ul>
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Commands/QueueProxy.html" title="Adhearsion::VoIP::Asterisk::Commands::QueueProxy (class)">Adhearsion::VoIP::Asterisk::Commands::QueueProxy</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
a queue proxy object
</p>
</div>
      
    </li>
  
</ul>

  <h3>See Also:</h3>
  <ul class="see">
    
      <li><a href="http://www.voip-info.org/wiki-Asterisk+cmd+Queue" target="_parent" title="Full information on the Asterisk Queue">Full information on the Asterisk Queue</a></li>
    
      <li><span class='object_link'><a href="Commands/QueueProxy.html#join%21-instance_method" title="Adhearsion::VoIP::Asterisk::Commands::QueueProxy#join! (method)">join!() for further details</a></span></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


824
825
826
827
828
829
830
831
832
833
834
835
836
837</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/adhearsion/voip/asterisk/commands.rb', line 824</span>

<span class='kw'>def</span> <span class='id queue'>queue</span><span class='lparen'>(</span><span class='id queue_name'>queue_name</span><span class='rparen'>)</span>
  <span class='id queue_name'>queue_name</span> <span class='op'>=</span> <span class='id queue_name'>queue_name</span><span class='period'>.</span><span class='id to_s'>to_s</span>

  <span class='ivar'>@queue_proxy_hash_lock</span> <span class='op'>=</span> <span class='const'>Mutex</span><span class='period'>.</span><span class='id new'>new</span> <span class='kw'>unless</span> <span class='kw'>defined?</span> <span class='ivar'>@queue_proxy_hash_lock</span>
  <span class='ivar'>@queue_proxy_hash_lock</span><span class='period'>.</span><span class='id synchronize'>synchronize</span> <span class='kw'>do</span>
    <span class='ivar'>@queue_proxy_hash</span> <span class='op'>||=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
    <span class='kw'>if</span> <span class='ivar'>@queue_proxy_hash</span><span class='period'>.</span><span class='id has_key?'>has_key?</span> <span class='id queue_name'>queue_name</span>
      <span class='kw'>return</span> <span class='ivar'>@queue_proxy_hash</span><span class='lbracket'>[</span><span class='id queue_name'>queue_name</span><span class='rbracket'>]</span>
    <span class='kw'>else</span>
      <span class='id proxy'>proxy</span> <span class='op'>=</span> <span class='ivar'>@queue_proxy_hash</span><span class='lbracket'>[</span><span class='id queue_name'>queue_name</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>QueueProxy</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='id queue_name'>queue_name</span><span class='comma'>,</span> <span class='kw'>self</span><span class='rparen'>)</span>
      <span class='kw'>return</span> <span class='id proxy'>proxy</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="quote_arg-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>quote_arg</strong>(arg) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Arguments surrounded by quotes; quotes backslash-escaped. See parse_args in
asterisk/res/res_agi.c (Asterisk 1.4.21.1)
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


121
122
123</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/adhearsion/voip/asterisk/commands.rb', line 121</span>

<span class='kw'>def</span> <span class='id quote_arg'>quote_arg</span><span class='lparen'>(</span><span class='id arg'>arg</span><span class='rparen'>)</span>
  <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;</span><span class='tstring_end'>'</span></span> <span class='op'>+</span> <span class='id arg'>arg</span><span class='period'>.</span><span class='id to_s'>to_s</span><span class='period'>.</span><span class='id gsub'>gsub</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>[&quot;\\]</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id m'>m</span><span class='op'>|</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\\</span><span class='embexpr_beg'>#{</span><span class='id m'>m</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&quot;</span><span class='tstring_end'>'</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="raw_response-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>raw_response</strong>(message = nil) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
The underlying method executed by nearly all the command methods in this
module. Used to send the plaintext commands in the proper AGI format over
TCP/IP back to an Asterisk server via the FAGI protocol.
</p>
<p>
It is not recommended that you call this method directly unless you plan to
write a new command method in which case use this to communicate directly
with an Asterisk server via the FAGI protocol.
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>message</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
    </li>
  
</ul>

  <h3>See Also:</h3>
  <ul class="see">
    
      <li><a href="http://www.voip-info.org/wiki/view/Asterisk+FastAGI" target="_parent" title="More information about FAGI">More information about FAGI</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


101
102
103
104
105
106
107
108
109</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/adhearsion/voip/asterisk/commands.rb', line 101</span>

<span class='kw'>def</span> <span class='id raw_response'>raw_response</span><span class='lparen'>(</span><span class='id message'>message</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='id message'>message</span><span class='period'>.</span><span class='id squish!'>squish!</span>
  <span class='ivar'>@call</span><span class='period'>.</span><span class='id with_command_lock'>with_command_lock</span> <span class='kw'>do</span>
    <span class='id raise'>raise</span> <span class='const'>ArgumentError</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>illegal NUL in message </span><span class='embexpr_beg'>#{</span><span class='id message'>message</span><span class='period'>.</span><span class='id inspect'>inspect</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id message'>message</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\0</span><span class='regexp_end'>/</span></span>
    <span class='id ahn_log'>ahn_log</span><span class='period'>.</span><span class='id agi'>agi</span><span class='period'>.</span><span class='id debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&gt;&gt;&gt; </span><span class='embexpr_beg'>#{</span><span class='id message'>message</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='id write'>write</span> <span class='id message'>message</span> <span class='kw'>if</span> <span class='id message'>message</span>
    <span class='id read'>read</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="read-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>read</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Utility method to read from pbx. Hangup if nil.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/adhearsion/voip/asterisk/commands.rb', line 57</span>

<span class='kw'>def</span> <span class='id read'>read</span>
  <span class='id from_pbx'>from_pbx</span><span class='period'>.</span><span class='id gets'>gets</span><span class='period'>.</span><span class='id tap'>tap</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id message'>message</span><span class='op'>|</span>
    <span class='comment'># AGI has many conditions that might indicate a hangup
</span>    <span class='id raise'>raise</span> <span class='const'>Hangup</span> <span class='kw'>if</span> <span class='id message'>message</span><span class='period'>.</span><span class='id nil?'>nil?</span>

    <span class='id ahn_log'>ahn_log</span><span class='period'>.</span><span class='id agi'>agi</span><span class='period'>.</span><span class='id debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&lt;&lt;&lt; </span><span class='embexpr_beg'>#{</span><span class='id message'>message</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>

    <span class='id code'>code</span><span class='comma'>,</span> <span class='id rest'>rest</span> <span class='op'>=</span> <span class='op'>*</span><span class='id message'>message</span><span class='period'>.</span><span class='id split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'> </span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='int'>2</span><span class='rparen'>)</span>

    <span class='kw'>case</span> <span class='id code'>code</span><span class='period'>.</span><span class='id to_i'>to_i</span>
    <span class='kw'>when</span> <span class='int'>510</span>
      <span class='comment'># This error is non-fatal for the call
</span>      <span class='id ahn_log'>ahn_log</span><span class='period'>.</span><span class='id agi'>agi</span><span class='period'>.</span><span class='id warn'>warn</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>510: Invalid or unknown AGI command</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>when</span> <span class='int'>511</span>
      <span class='comment'># 511 Command Not Permitted on a dead channel
</span>      <span class='id ahn_log'>ahn_log</span><span class='period'>.</span><span class='id agi'>agi</span><span class='period'>.</span><span class='id debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>511: Dead channel. Raising Hangup</span><span class='tstring_end'>&quot;</span></span>
      <span class='id raise'>raise</span> <span class='const'>Hangup</span>
    <span class='kw'>when</span> <span class='int'>520</span>
      <span class='comment'># This error is non-fatal for the call
</span>      <span class='id ahn_log'>ahn_log</span><span class='period'>.</span><span class='id agi'>agi</span><span class='period'>.</span><span class='id warn'>warn</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>520: Invalid command syntax</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>when</span> <span class='lparen'>(</span><span class='int'>500</span><span class='op'>..</span><span class='int'>599</span><span class='rparen'>)</span>
      <span class='comment'># Assume this error is non-fatal for the call and try to keep running
</span>      <span class='id ahn_log'>ahn_log</span><span class='period'>.</span><span class='id agi'>agi</span><span class='period'>.</span><span class='id warn'>warn</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id code'>code</span><span class='rbrace'>}</span><span class='tstring_content'>: Unknown AGI protocol error.</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>

    <span class='comment'># If the message starts with HANGUP it's a silly 1.6 OOB message
</span>    <span class='kw'>case</span> <span class='id message'>message</span>
    <span class='kw'>when</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^HANGUP</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^HANGUP\n?$</span><span class='regexp_end'>/i</span></span><span class='comma'>,</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^HANGUP\s?\d{3}</span><span class='regexp_end'>/i</span></span>
      <span class='id ahn_log'>ahn_log</span><span class='period'>.</span><span class='id agi'>agi</span><span class='period'>.</span><span class='id debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AGI HANGUP. Raising hangup</span><span class='tstring_end'>&quot;</span></span>
      <span class='id raise'>raise</span> <span class='const'>Hangup</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="record-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../String.html" title="String (class)">String</a></span></tt>) <strong>record</strong>(*args) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Records a sound file with the given name. If no filename is specified a
file named by Asterisk will be created and returned. Else the given
filename will be returned. If a relative path is given, the file will be
saved in the default Asterisk sound directory, /var/lib/spool/asterisk by
default.
</p>
<p>
<tt>:silence</tt> - silence in seconds
</p>
<p>
<tt>:maxduration</tt> - maximum duration in seconds
</p>
<p>
<tt>:escapedigits</tt> - digits to be used to excape from recording
</p>
<p>
<tt>:beep</tt> - soundfile to use as a beep before recording.  if not
specifed defaults to system generated beep,  
</p>
<pre class="code">
          set to nil for no beep.
</pre>
<p>
<tt>:format</tt> - the format of the file to be recorded
</p>
<p>
Silence and maxduration is specified in seconds.
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h3>Examples:</h3>
    
      <h4><div class='inline'><p>
Asterisk generated filename
</p>
</div></h4>
      <pre class="example code"><span class='id filename'>filename</span> <span class='op'>=</span> <span class='id record'>record</span></pre>
    
      <h4><div class='inline'><p>
Specified filename
</p>
</div></h4>
      <pre class="example code"><span class='id record'>record</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/path/to/my-file.gsm</span><span class='tstring_end'>'</span></span></pre>
    
      <h4><div class='inline'><p>
All options specified
</p>
</div></h4>
      <pre class="example code"><span class='id record'>record</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>my-file.gsm</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='symbol'>:silence</span> <span class='op'>=&gt;</span> <span class='int'>5</span><span class='comma'>,</span> <span class='symbol'>:maxduration</span> <span class='op'>=&gt;</span> <span class='int'>120</span></pre>
    
  </div>
<h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>file</span>
      
      
        <span class='type'>(<tt>string</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
name to record to.  Full path information is optional.  If you want to
change the format of the file you will want to add a .<valid extention> to
the end of the file name specifying the  filetype you want to record in. 
Alternately you can pass it is as :format in the options
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>hash</tt>)</span>
      
      
      
    </li>
  
</ul>
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
The filename of the recorded file.
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/adhearsion/voip/asterisk/commands.rb', line 326</span>

<span class='kw'>def</span> <span class='id record'>record</span><span class='lparen'>(</span><span class='op'>*</span><span class='id args'>args</span><span class='rparen'>)</span>
  <span class='id options'>options</span> <span class='op'>=</span> <span class='id args'>args</span><span class='period'>.</span><span class='id last'>last</span><span class='period'>.</span><span class='id kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Hash</span><span class='rparen'>)</span> <span class='op'>?</span> <span class='id args'>args</span><span class='period'>.</span><span class='id last'>last</span> <span class='op'>:</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='id filename'>filename</span> <span class='op'>=</span> <span class='id args'>args</span><span class='period'>.</span><span class='id first'>first</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id args'>args</span><span class='period'>.</span><span class='id first'>first</span><span class='period'>.</span><span class='id kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Hash</span><span class='rparen'>)</span> <span class='op'>?</span> <span class='const'>String</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='id args'>args</span><span class='period'>.</span><span class='id first'>first</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/tmp/recording_%d</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>if</span> <span class='id filename'>filename</span><span class='period'>.</span><span class='id index'>index</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%d</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='ivar'>@call</span><span class='period'>.</span><span class='id variables'>variables</span><span class='period'>.</span><span class='id has_key?'>has_key?</span><span class='lparen'>(</span><span class='symbol'>:recording_counter</span><span class='rparen'>)</span>
      <span class='ivar'>@call</span><span class='period'>.</span><span class='id variables'>variables</span><span class='lbracket'>[</span><span class='symbol'>:recording_counter</span><span class='rbracket'>]</span> <span class='op'>+=</span> <span class='int'>1</span>
    <span class='kw'>else</span>
      <span class='ivar'>@call</span><span class='period'>.</span><span class='id variables'>variables</span><span class='lbracket'>[</span><span class='symbol'>:recording_counter</span><span class='rbracket'>]</span>  <span class='op'>=</span> <span class='int'>0</span>
    <span class='kw'>end</span>
    <span class='id filename'>filename</span> <span class='op'>=</span> <span class='id filename'>filename</span> <span class='op'>%</span> <span class='ivar'>@call</span><span class='period'>.</span><span class='id variables'>variables</span><span class='lbracket'>[</span><span class='symbol'>:recording_counter</span><span class='rbracket'>]</span>
    <span class='ivar'>@call</span><span class='period'>.</span><span class='id variables'>variables</span><span class='lbracket'>[</span><span class='symbol'>:recording_counter</span><span class='rbracket'>]</span> <span class='op'>-=</span> <span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='lparen'>(</span><span class='op'>!</span><span class='id options'>options</span><span class='period'>.</span><span class='id has_key?'>has_key?</span><span class='lparen'>(</span><span class='symbol'>:format</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='id format'>format</span> <span class='op'>=</span> <span class='id filename'>filename</span><span class='period'>.</span><span class='id slice!'>slice!</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\.[^\.]+$</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='lparen'>(</span><span class='id format'>format</span><span class='period'>.</span><span class='id nil?'>nil?</span><span class='rparen'>)</span>
      <span class='id ahn_log'>ahn_log</span><span class='period'>.</span><span class='id agi'>agi</span><span class='period'>.</span><span class='id warn'>warn</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Format not specified and not detected.  Defaulting to \&quot;gsm\&quot;</span><span class='tstring_end'>&quot;</span></span>
      <span class='id format'>format</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>gsm</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
    <span class='id format'>format</span><span class='period'>.</span><span class='id sub!'>sub!</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^\.</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='id format'>format</span> <span class='op'>=</span> <span class='id options'>options</span><span class='lbracket'>[</span><span class='symbol'>:format</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>
  <span class='id record_to_file'>record_to_file</span><span class='lparen'>(</span><span class='op'>*</span><span class='id args'>args</span><span class='rparen'>)</span>
  <span class='id filename'>filename</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>.</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='id format'>format</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="record_to_file-instance_method">
  
    - (<tt>Symbol</tt>) <strong>record_to_file</strong>(*args) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Records a sound file with the given name. If no filename is specified a
file named by Asterisk will be created and returned. Else the given
filename will be returned. If a relative path is given, the file will be
saved in the default Asterisk sound directory, /var/lib/spool/asterisk by
default.
</p>
<p>
<tt>:silence</tt> - silence in seconds
</p>
<p>
<tt>:maxduration</tt> - maximum duration in seconds
</p>
<p>
<tt>:escapedigits</tt> - digits to be used to excape from recording
</p>
<p>
<tt>:beep</tt> - soundfile to use as a beep before recording.  if not
specifed defaults to system generated beep,  
</p>
<pre class="code">
          set to nil for no beep.
</pre>
<p>
<tt>:format</tt> - the format of the file to be recorded.  This will
over-ride a implicit format in a file extension
</p>
<pre class="code">
          and append a .&lt;format&gt; to the end of the file.
</pre>
<p>
Silence and maxduration is specified in seconds.
</p>
<p>
A sound file will be recorded to the specifed file unless a :write_error is
returned.  A :success_dtmf is for when a call was ended with a DTMF tone. 
A :success_timeout is returned when a call times out due to  a silence
longer than the specified silence or if the recording reaches the
maxduration.
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h3>Examples:</h3>
    
      <h4><div class='inline'><p>
Asterisk generated filename
</p>
</div></h4>
      <pre class="example code"><span class='id filename'>filename</span> <span class='op'>=</span> <span class='id record'>record</span></pre>
    
      <h4><div class='inline'><p>
Specified filename
</p>
</div></h4>
      <pre class="example code"><span class='id record'>record</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/path/to/my-file.gsm</span><span class='tstring_end'>'</span></span></pre>
    
      <h4><div class='inline'><p>
All options specified
</p>
</div></h4>
      <pre class="example code"><span class='id record'>record</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>my-file.gsm</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='symbol'>:silence</span> <span class='op'>=&gt;</span> <span class='int'>5</span><span class='comma'>,</span> <span class='symbol'>:maxduration</span> <span class='op'>=&gt;</span> <span class='int'>120</span></pre>
    
  </div>
<h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>file</span>
      
      
        <span class='type'>(<tt>string</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
name to record to.  Full path information is optional.  If you want to
change the format of the file you will want to add a .<valid extention> to
the end of the file name specifying the  filetype you want to record in. 
If you don&#8217;t specify a valid extension it will default to gsm and a
.gsm will be added to the file.  If you don&#8217;t specify a filename it
will write one in /tmp/recording_%d with %d being a counter that increments
from 0 onward for the particular call you are making.
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>hash</tt>)</span>
      
      
      
    </li>
  
</ul>
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
One of the follwing.&#8230;. :hangup, :write_error, :success_dtmf,
:success_timeout
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


393
394
395</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/adhearsion/voip/asterisk/commands.rb', line 393</span>

<span class='kw'>def</span> <span class='id record_to_file'>record_to_file</span><span class='lparen'>(</span><span class='op'>*</span><span class='id args'>args</span><span class='rparen'>)</span>
  <span class='id base_record_to_file'>base_record_to_file</span><span class='lparen'>(</span><span class='op'>*</span><span class='id args'>args</span><span class='rparen'>)</span><span class='period'>.</span><span class='id last'>last</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="record_to_file!-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>record_to_file!</strong>(*args) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
This works the same record_to_file except is throws an exception if a
playback or write error occurs.
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


399
400
401
402
403
404
405
406
407
408</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/adhearsion/voip/asterisk/commands.rb', line 399</span>

<span class='kw'>def</span> <span class='id record_to_file!'>record_to_file!</span><span class='lparen'>(</span><span class='op'>*</span><span class='id args'>args</span><span class='rparen'>)</span>
   <span class='comment'># raise PlaybackError, &quot;Playback failed with PLAYBACKSTATUS: #{playback.inspect}.  The raw response was #{response.inspect}.&quot;
</span>  <span class='id return_values'>return_values</span> <span class='op'>=</span> <span class='id base_record_to_file'>base_record_to_file</span><span class='lparen'>(</span><span class='op'>*</span><span class='id args'>args</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id return_values'>return_values</span><span class='period'>.</span><span class='id first'>first</span> <span class='op'>==</span> <span class='symbol'>:playback_error</span>
    <span class='id raise'>raise</span> <span class='const'>PlaybackError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Playback failed with PLAYBACKSTATUS: </span><span class='embexpr_beg'>#{</span><span class='id return_values'>return_values</span><span class='period'>.</span><span class='id second'>second</span><span class='period'>.</span><span class='id inspect'>inspect</span><span class='rbrace'>}</span><span class='tstring_content'>.</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>elsif</span> <span class='id return_values'>return_values</span><span class='period'>.</span><span class='id first'>first</span> <span class='op'>==</span> <span class='symbol'>:write_error</span>
    <span class='id raise'>raise</span> <span class='const'>RecordError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Record failed on write.</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  <span class='id return_values'>return_values</span><span class='period'>.</span><span class='id first'>first</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="response-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>response</strong>(command, *arguments) 
  

  
</p><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


111
112
113
114
115
116
117</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/adhearsion/voip/asterisk/commands.rb', line 111</span>

<span class='kw'>def</span> <span class='id response'>response</span><span class='lparen'>(</span><span class='id command'>command</span><span class='comma'>,</span> <span class='op'>*</span><span class='id arguments'>arguments</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id arguments'>arguments</span><span class='period'>.</span><span class='id empty?'>empty?</span>
    <span class='id raw_response'>raw_response</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id command'>command</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='id raw_response'>raw_response</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id command'>command</span><span class='rbrace'>}</span><span class='tstring_content'> </span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='id arguments'>arguments</span><span class='period'>.</span><span class='id map'>map</span><span class='lbrace'>{</span> <span class='op'>|</span><span class='id arg'>arg</span><span class='op'>|</span> <span class='id quote_arg'>quote_arg</span><span class='lparen'>(</span><span class='id arg'>arg</span><span class='rparen'>)</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'> </span><span class='tstring_end'>'</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="say_chars-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>say_chars</strong>(text) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Executes the SayAlpha command. This command will read the text passed in
out loud, character-by-character.
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h3>Examples:</h3>
    
      <h4><div class='inline'><p>
Say &#8220;one a two dot pound&#8220;
</p>
</div></h4>
      <pre class="example code"><span class='id say_chars'>say_chars</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1a2.#</span><span class='tstring_end'>&quot;</span></span></pre>
    
  </div>
<h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>Passed</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
in as the text to read aloud
</p>
</div>
      
    </li>
  
</ul>

  <h3>See Also:</h3>
  <ul class="see">
    
      <li><a href="http://www.voip-info.org/wiki/view/Asterisk+cmd+SayAlpha" target="_parent" title="Asterisk SayPhonetic Command">Asterisk SayPhonetic Command</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1298
1299
1300</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/adhearsion/voip/asterisk/commands.rb', line 1298</span>

<span class='kw'>def</span> <span class='id say_chars'>say_chars</span><span class='lparen'>(</span><span class='id text'>text</span><span class='rparen'>)</span>
  <span class='id execute'>execute</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>sayalpha</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id text'>text</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="say_digits-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>say_digits</strong>(digits) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Speaks the digits given as an argument. For example, &#8220;123&#8221; is
spoken as &#8220;one two three&#8221;.
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>digits</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1223
1224
1225</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/adhearsion/voip/asterisk/commands.rb', line 1223</span>

<span class='kw'>def</span> <span class='id say_digits'>say_digits</span><span class='lparen'>(</span><span class='id digits'>digits</span><span class='rparen'>)</span>
  <span class='id execute'>execute</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>saydigits</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id validate_digits'>validate_digits</span><span class='lparen'>(</span><span class='id digits'>digits</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="say_phonetic-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>say_phonetic</strong>(text) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Executes the SayPhonetic command. This command will read the text passed in
out load using the NATO phonetic alphabet.
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>Passed</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
in as the text to read aloud
</p>
</div>
      
    </li>
  
</ul>

  <h3>See Also:</h3>
  <ul class="see">
    
      <li><a href="http://www.voip-info.org/wiki/view/Asterisk+cmd+SayPhonetic" target="_parent" title="Asterisk SayPhonetic Command">Asterisk SayPhonetic Command</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1284
1285
1286</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/adhearsion/voip/asterisk/commands.rb', line 1284</span>

<span class='kw'>def</span> <span class='id say_phonetic'>say_phonetic</span><span class='lparen'>(</span><span class='id text'>text</span><span class='rparen'>)</span>
  <span class='id execute'>execute</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>sayphonetic</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id text'>text</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="set_variable-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>set_variable</strong>(variable_name, value) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Pass information back to the asterisk dial plan.
</p>
<p>
Keep in mind that the variables are not global variables. These variables
only exist for the channel related to the call that is being serviced by
the particular instance of your adhearsion application. You will not be
able to pass information back to the asterisk dialplan for other instances
of your adhearsion application to share. Once the channel is
&#8220;hungup&#8221; then the variables are cleared and their information
is gone.
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>variable_name</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
    </li>
  
    <li>
      
        <span class='name'>value</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

  <h3>See Also:</h3>
  <ul class="see">
    
      <li><a href="http://www.voip-info.org/wiki/view/set+variable" target="_parent" title="Asterisk Set Variable">Asterisk Set Variable</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1020
1021
1022</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/adhearsion/voip/asterisk/commands.rb', line 1020</span>

<span class='kw'>def</span> <span class='id set_variable'>set_variable</span><span class='lparen'>(</span><span class='id variable_name'>variable_name</span><span class='comma'>,</span> <span class='id value'>value</span><span class='rparen'>)</span>
  <span class='id response'>response</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SET VARIABLE</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id variable_name'>variable_name</span><span class='comma'>,</span> <span class='id value'>value</span><span class='rparen'>)</span> <span class='op'>==</span> <span class='const'>AGI_SUCCESSFUL_RESPONSE</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="sip_add_header-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../String.html" title="String (class)">String</a></span></tt>) <strong>sip_add_header</strong>(header, value) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Issue the command to add a custom SIP header to the current call channel
example use: sip_add_header(&#8220;x-ahn-test&#8221;,
&#8220;rubyrox&#8221;)
</p>
<p>
@param[String] the name of the SIP header @param[String] the value of the
SIP header
</p>


  </div>
</div>
<div class="tags">
  <h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the Asterisk response
</p>
</div>
      
    </li>
  
</ul>

  <h3>See Also:</h3>
  <ul class="see">
    
      <li><a href="http://www.voip-info.org/wiki/index.php?page=Asterisk+cmd+SIPAddHeader" target="_parent" title="Asterisk SIPAddHeader">Asterisk SIPAddHeader</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1033
1034
1035</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/adhearsion/voip/asterisk/commands.rb', line 1033</span>

<span class='kw'>def</span> <span class='id sip_add_header'>sip_add_header</span><span class='lparen'>(</span><span class='id header'>header</span><span class='comma'>,</span> <span class='id value'>value</span><span class='rparen'>)</span>
  <span class='id execute'>execute</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SIPAddHeader</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id header'>header</span><span class='rbrace'>}</span><span class='tstring_content'>: </span><span class='embexpr_beg'>#{</span><span class='id value'>value</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='op'>==</span> <span class='const'>AGI_SUCCESSFUL_RESPONSE</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="sip_get_header-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../String.html" title="String (class)">String</a></span></tt>) <strong>sip_get_header</strong>(header) 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='sip_header-instance_method'>sip_header</span></span>
    </span>
  
</p><div class="docstring">
  <div class="discussion">
    <p>
Issue the command to fetch a SIP header from the current call channel
example use: sip_get_header(&#8220;x-ahn-test&#8221;)
</p>
<p>
@param[String] the name of the SIP header to get
</p>


  </div>
</div>
<div class="tags">
  <h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the Asterisk response
</p>
</div>
      
    </li>
  
</ul>

  <h3>See Also:</h3>
  <ul class="see">
    
      <li><a href="http://www.voip-info.org/wiki/index.php?page=Asterisk+cmd+SIPGetHeader" target="_parent" title="Asterisk SIPGetHeader">Asterisk SIPGetHeader</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1045
1046
1047</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/adhearsion/voip/asterisk/commands.rb', line 1045</span>

<span class='kw'>def</span> <span class='id sip_get_header'>sip_get_header</span><span class='lparen'>(</span><span class='id header'>header</span><span class='rparen'>)</span>
  <span class='id get_variable'>get_variable</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>SIP_HEADER(</span><span class='embexpr_beg'>#{</span><span class='id header'>header</span><span class='rbrace'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="speak-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>speak</strong>(text, options = {}) 
  

  
</p><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>text</span>
      
      
        <span class='type'>(<tt>#to_s</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
to speak using the TTS engine
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
    </li>
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Symbol</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>
:engine the engine to use. Currently supported engines are :cepstral and
:unimrcp
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>
:barge_in_digits digits to allow the TTS to be interrupted with
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


865
866
867
868
869</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/adhearsion/voip/asterisk/commands.rb', line 865</span>

<span class='kw'>def</span> <span class='id speak'>speak</span><span class='lparen'>(</span><span class='id text'>text</span><span class='comma'>,</span> <span class='id options'>options</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='id engine'>engine</span> <span class='op'>=</span> <span class='id options'>options</span><span class='period'>.</span><span class='id delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:engine</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='const'>AHN_CONFIG</span><span class='period'>.</span><span class='id asterisk'>asterisk</span><span class='period'>.</span><span class='id speech_engine'>speech_engine</span> <span class='op'>||</span> <span class='symbol'>:none</span>
  <span class='id options'>options</span><span class='lbracket'>[</span><span class='symbol'>:interruptible</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>false</span> <span class='kw'>unless</span> <span class='id options'>options</span><span class='period'>.</span><span class='id has_key?'>has_key?</span><span class='lparen'>(</span><span class='symbol'>:interruptible</span><span class='rparen'>)</span>
  <span class='const'>SpeechEngines</span><span class='period'>.</span><span class='id send'>send</span><span class='lparen'>(</span><span class='id engine'>engine</span><span class='comma'>,</span> <span class='kw'>self</span><span class='comma'>,</span> <span class='id text'>text</span><span class='period'>.</span><span class='id to_s'>to_s</span><span class='comma'>,</span> <span class='id options'>options</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="variable-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>variable</strong>(*args) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Allows you to either set or get a channel variable from Asterisk. The
method takes a hash key/value pair if you would like to set a variable Or a
single string with the variable to get from Asterisk
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1053
1054
1055
1056
1057
1058
1059
1060
1061
1062
1063
1064
1065
1066
1067</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/adhearsion/voip/asterisk/commands.rb', line 1053</span>

<span class='kw'>def</span> <span class='id variable'>variable</span><span class='lparen'>(</span><span class='op'>*</span><span class='id args'>args</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id args'>args</span><span class='period'>.</span><span class='id last'>last</span><span class='period'>.</span><span class='id kind_of?'>kind_of?</span> <span class='const'>Hash</span>
    <span class='id assignments'>assignments</span> <span class='op'>=</span> <span class='id args'>args</span><span class='period'>.</span><span class='id pop'>pop</span>
    <span class='id raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Can't mix variable setting and fetching!</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id args'>args</span><span class='period'>.</span><span class='id any?'>any?</span>
    <span class='id assignments'>assignments</span><span class='period'>.</span><span class='id each_pair'>each_pair</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id key'>key</span><span class='comma'>,</span> <span class='id value'>value</span><span class='op'>|</span>
      <span class='id set_variable'>set_variable</span><span class='lparen'>(</span><span class='id key'>key</span><span class='comma'>,</span> <span class='id value'>value</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='kw'>if</span> <span class='id args'>args</span><span class='period'>.</span><span class='id size'>size</span> <span class='op'>==</span> <span class='int'>1</span>
      <span class='id get_variable'>get_variable</span> <span class='id args'>args</span><span class='period'>.</span><span class='id first'>first</span>
    <span class='kw'>else</span>
      <span class='id args'>args</span><span class='period'>.</span><span class='id map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id var'>var</span><span class='op'>|</span> <span class='id get_variable'>get_variable</span><span class='lparen'>(</span><span class='id var'>var</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="verbose-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>verbose</strong>(message, level = nil) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Sends a message to the console via the verbose message system.
</p>
<p>
of actions happening within Adhearsion.
</p>
<pre class="code">
  verbose 'Processing call with Adhearsion' 3</pre>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h3>Examples:</h3>
    
      <h4><div class='inline'><p>
Use this command to inform someone watching the Asterisk console
</p>
</div></h4>
      <pre class="example code"></pre>
    
  </div>
<h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>message</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
    </li>
  
    <li>
      
        <span class='name'>level</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
    </li>
  
</ul>
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'></span>
      
      
      
        
        <div class='inline'><p>
the result of the command
</p>
</div>
      
    </li>
  
</ul>

  <h3>See Also:</h3>
  <ul class="see">
    
      <li><a href="http://www.voip-info.org/wiki/view/verbose" target="_parent" title="http://www.voip-info.org/wiki/view/verbose">http://www.voip-info.org/wiki/view/verbose</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


192
193
194
195
196</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/adhearsion/voip/asterisk/commands.rb', line 192</span>

<span class='kw'>def</span> <span class='id verbose'>verbose</span><span class='lparen'>(</span><span class='id message'>message</span><span class='comma'>,</span> <span class='id level'>level</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id result'>result</span> <span class='op'>=</span> <span class='id response'>response</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>VERBOSE</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='id message'>message</span><span class='comma'>,</span> <span class='id level'>level</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>if</span> <span class='id error?'>error?</span><span class='lparen'>(</span><span class='id result'>result</span><span class='rparen'>)</span>
    <span class='id result'>result</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="voicemail-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>voicemail</strong>(*args) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Send a caller to a voicemail box to leave a message.
</p>
<p>
The method takes the mailbox_number of the user to leave a message for and
a greeting_option that will determine which message gets played to the
caller.
</p>


  </div>
</div>
<div class="tags">
  <h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
    </li>
  
</ul>

  <h3>See Also:</h3>
  <ul class="see">
    
      <li><a href="http://www.voip-info.org/tiki-index.php?page=Asterisk+cmd+VoiceMail" target="_parent" title="Asterisk Voicemail">Asterisk Voicemail</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1075
1076
1077
1078
1079
1080
1081
1082
1083
1084
1085
1086
1087
1088
1089
1090
1091
1092
1093
1094
1095
1096
1097
1098
1099
1100
1101
1102
1103
1104
1105</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/adhearsion/voip/asterisk/commands.rb', line 1075</span>

<span class='kw'>def</span> <span class='id voicemail'>voicemail</span><span class='lparen'>(</span><span class='op'>*</span><span class='id args'>args</span><span class='rparen'>)</span>
  <span class='id options_hash'>options_hash</span>    <span class='op'>=</span> <span class='id args'>args</span><span class='period'>.</span><span class='id last'>last</span><span class='period'>.</span><span class='id kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Hash</span><span class='rparen'>)</span> <span class='op'>?</span> <span class='id args'>args</span><span class='period'>.</span><span class='id pop'>pop</span> <span class='op'>:</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='id mailbox_number'>mailbox_number</span>  <span class='op'>=</span> <span class='id args'>args</span><span class='period'>.</span><span class='id shift'>shift</span>
  <span class='id greeting_option'>greeting_option</span> <span class='op'>=</span> <span class='id options_hash'>options_hash</span><span class='period'>.</span><span class='id delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:greeting</span><span class='rparen'>)</span>
  <span class='id skip_option'>skip_option</span>     <span class='op'>=</span> <span class='id options_hash'>options_hash</span><span class='period'>.</span><span class='id delete'>delete</span><span class='lparen'>(</span><span class='symbol'>:skip</span><span class='rparen'>)</span>
  <span class='id raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>You supplied too many arguments!</span><span class='tstring_end'>'</span></span> <span class='kw'>if</span> <span class='id mailbox_number'>mailbox_number</span> <span class='op'>&amp;&amp;</span> <span class='id options_hash'>options_hash</span><span class='period'>.</span><span class='id any?'>any?</span>
  <span class='id greeting_option'>greeting_option</span> <span class='op'>=</span> <span class='kw'>case</span> <span class='id greeting_option'>greeting_option</span>
    <span class='kw'>when</span> <span class='symbol'>:busy</span> <span class='kw'>then</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>b</span><span class='tstring_end'>'</span></span>
    <span class='kw'>when</span> <span class='symbol'>:unavailable</span> <span class='kw'>then</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>u</span><span class='tstring_end'>'</span></span>
    <span class='kw'>when</span> <span class='kw'>nil</span> <span class='kw'>then</span> <span class='kw'>nil</span>
    <span class='kw'>else</span> <span class='id raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unrecognized greeting </span><span class='embexpr_beg'>#{</span><span class='id greeting_option'>greeting_option</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  <span class='id skip_option'>skip_option</span> <span class='op'>&amp;&amp;=</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>s</span><span class='tstring_end'>'</span></span>
  <span class='id options'>options</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id greeting_option'>greeting_option</span><span class='rbrace'>}</span><span class='embexpr_beg'>#{</span><span class='id skip_option'>skip_option</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>

  <span class='id raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Mailbox cannot be blank!</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='op'>!</span><span class='id mailbox_number'>mailbox_number</span><span class='period'>.</span><span class='id nil?'>nil?</span> <span class='op'>&amp;&amp;</span> <span class='id mailbox_number'>mailbox_number</span><span class='period'>.</span><span class='id blank?'>blank?</span>
  <span class='id number_with_context'>number_with_context</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id mailbox_number'>mailbox_number</span> <span class='kw'>then</span> <span class='id mailbox_number'>mailbox_number</span> <span class='kw'>else</span>
    <span class='id raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>You must supply ONE context name!</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id options_hash'>options_hash</span><span class='period'>.</span><span class='id size'>size</span> <span class='op'>!=</span> <span class='int'>1</span>
    <span class='id context_name'>context_name</span><span class='comma'>,</span> <span class='id mailboxes'>mailboxes</span> <span class='op'>=</span> <span class='id options_hash'>options_hash</span><span class='period'>.</span><span class='id to_a'>to_a</span><span class='period'>.</span><span class='id first'>first</span>
    <span class='const'>Array</span><span class='lparen'>(</span><span class='id mailboxes'>mailboxes</span><span class='rparen'>)</span><span class='period'>.</span><span class='id map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id mailbox'>mailbox</span><span class='op'>|</span>
      <span class='id raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Mailbox numbers must be numerical!</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='id mailbox'>mailbox</span><span class='period'>.</span><span class='id to_s'>to_s</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^\d+$</span><span class='regexp_end'>/</span></span>
      <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id mailbox'>mailbox</span><span class='rbrace'>}</span><span class='tstring_content'>@</span><span class='embexpr_beg'>#{</span><span class='id context_name'>context_name</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span><span class='period'>.</span><span class='id join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>&amp;</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='id execute'>execute</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>voicemail</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='id number_with_context'>number_with_context</span><span class='comma'>,</span> <span class='id options'>options</span><span class='rparen'>)</span>
  <span class='kw'>case</span> <span class='id variable'>variable</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>VMSTATUS</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
    <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>SUCCESS</span><span class='tstring_end'>'</span></span> <span class='kw'>then</span> <span class='kw'>true</span>
    <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>USEREXIT</span><span class='tstring_end'>'</span></span> <span class='kw'>then</span> <span class='kw'>false</span>
    <span class='kw'>else</span> <span class='kw'>nil</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="voicemail_main-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>voicemail_main</strong>(options = {}) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
The voicemail_main method puts a caller into the voicemail system to fetch
their voicemail or set options for their voicemail box.
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
    </li>
  
</ul>

  <h3>See Also:</h3>
  <ul class="see">
    
      <li><a href="http://www.voip-info.org/wiki-Asterisk+cmd+VoiceMailMain" target="_parent" title="Asterisk VoiceMailMain Command">Asterisk VoiceMailMain Command</a></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1113
1114
1115
1116
1117
1118
1119
1120
1121
1122
1123
1124
1125
1126
1127
1128
1129
1130
1131
1132
1133
1134
1135
1136
1137
1138
1139
1140
1141
1142</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/adhearsion/voip/asterisk/commands.rb', line 1113</span>

<span class='kw'>def</span> <span class='id voicemail_main'>voicemail_main</span><span class='lparen'>(</span><span class='id options'>options</span><span class='op'>=</span><span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='id mailbox'>mailbox</span><span class='comma'>,</span> <span class='id context'>context</span><span class='comma'>,</span> <span class='id folder'>folder</span> <span class='op'>=</span> <span class='id options'>options</span><span class='period'>.</span><span class='id values_at'>values_at</span> <span class='symbol'>:mailbox</span><span class='comma'>,</span> <span class='symbol'>:context</span><span class='comma'>,</span> <span class='symbol'>:folder</span>
  <span class='id authenticate'>authenticate</span> <span class='op'>=</span> <span class='id options'>options</span><span class='period'>.</span><span class='id has_key?'>has_key?</span><span class='lparen'>(</span><span class='symbol'>:authenticate</span><span class='rparen'>)</span> <span class='op'>?</span> <span class='id options'>options</span><span class='lbracket'>[</span><span class='symbol'>:authenticate</span><span class='rbracket'>]</span> <span class='op'>:</span> <span class='kw'>true</span>

  <span class='id folder'>folder</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id folder'>folder</span>
    <span class='kw'>if</span> <span class='id folder'>folder</span><span class='period'>.</span><span class='id to_s'>to_s</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^[\w_]+$</span><span class='regexp_end'>/</span></span>
      <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>a(</span><span class='embexpr_beg'>#{</span><span class='id folder'>folder</span><span class='rbrace'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>else</span>
      <span class='id raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Voicemail folder must be alphanumerical/underscore characters only!</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>elsif</span> <span class='id folder'>folder</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_end'>'</span></span>
    <span class='id raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Folder name cannot be an empty String!</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>else</span>
    <span class='kw'>nil</span>
  <span class='kw'>end</span>

  <span class='id real_mailbox'>real_mailbox</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
  <span class='id real_mailbox'>real_mailbox</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id mailbox'>mailbox</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>  <span class='kw'>unless</span> <span class='id mailbox'>mailbox</span><span class='period'>.</span><span class='id blank?'>blank?</span>
  <span class='id real_mailbox'>real_mailbox</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>@</span><span class='embexpr_beg'>#{</span><span class='id context'>context</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='id context'>context</span><span class='period'>.</span><span class='id blank?'>blank?</span>

  <span class='id real_options'>real_options</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
  <span class='id real_options'>real_options</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>s</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='op'>!</span><span class='id authenticate'>authenticate</span>
  <span class='id real_options'>real_options</span> <span class='op'>&lt;&lt;</span> <span class='id folder'>folder</span> <span class='kw'>unless</span> <span class='id folder'>folder</span><span class='period'>.</span><span class='id blank?'>blank?</span>

  <span class='id command_args'>command_args</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id real_mailbox'>real_mailbox</span><span class='rbracket'>]</span>
  <span class='id command_args'>command_args</span> <span class='op'>&lt;&lt;</span> <span class='id real_options'>real_options</span> <span class='kw'>unless</span> <span class='id real_options'>real_options</span><span class='period'>.</span><span class='id blank?'>blank?</span>
  <span class='id command_args'>command_args</span><span class='period'>.</span><span class='id clear'>clear</span> <span class='kw'>if</span> <span class='id command_args'>command_args</span> <span class='op'>==</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>

  <span class='id execute'>execute</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>VoiceMailMain</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='op'>*</span><span class='id command_args'>command_args</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="with_next_message-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>with_next_message</strong>(&amp;block) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
The with_next_message method&#8230;
</p>


  </div>
</div>
<div class="tags">
  <h3>Raises:</h3>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>LocalJumpError</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


484
485
486
487</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/adhearsion/voip/asterisk/commands.rb', line 484</span>

<span class='kw'>def</span> <span class='id with_next_message'>with_next_message</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id block'>block</span><span class='rparen'>)</span>
  <span class='id raise'>raise</span> <span class='const'>LocalJumpError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Must supply a block</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='id block_given?'>block_given?</span>
  <span class='id block'>block</span><span class='period'>.</span><span class='id call'>call</span><span class='lparen'>(</span><span class='id next_message'>next_message</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="write-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>write</strong>(message) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Utility method to write to pbx.
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>message</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
raw message
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


52
53
54</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/adhearsion/voip/asterisk/commands.rb', line 52</span>

<span class='kw'>def</span> <span class='id write'>write</span><span class='lparen'>(</span><span class='id message'>message</span><span class='rparen'>)</span>
  <span class='id to_pbx'>to_pbx</span><span class='period'>.</span><span class='id print'>print</span> <span class='id message'>message</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Mon Aug  8 16:22:06 2011 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.7.2 (ruby-1.9.2).
</div>

  </body>
</html>